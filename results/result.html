<!DOCTYPE html><html><head><title></title><meta charset="utf-8"><style type="text/css">* {
	box-sizing: border-box;
}

html {
	font-size: 100%;
}

body {
	font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell',
		'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
	line-height: 1.6;
	font-size: 0.6875em; /* 11 pt */
	color: #111;
	margin: 0;
}

body > :first-child {
	padding-top: 0;
	margin-top: 0;
}

body > :last-child {
	margin-bottom: 0;
	padding-bottom: 0;
}

h1,
h2,
h3,
h4,
h5,
h6 {
	margin: 0;
	padding: 0.5em 0 0.25em;
}

h5,
h6 {
	padding: 0;
}

h5 {
	font-size: 1em;
}

h6 {
	font-size: 0.875em;
	text-transform: uppercase;
}

p {
	margin: 0.25em 0 1em;
}

blockquote {
	margin: 0.5em 0 1em;
	padding-left: 0.5em;
	padding-right: 1em;
	border-left: 4px solid gainsboro;
	font-style: italic;
}

ul,
ol {
	margin: 0;
	margin-left: 1em;
	padding: 0 1.5em 0.5em;
}

pre {
	white-space: pre-wrap;
}

h1 code,
h2 code,
h3 code,
h4 code,
h5 code,
h6 code,
p code,
li code,
pre code {
	background-color: #f8f8f8;
	padding: 0.1em 0.375em;
	border: 1px solid #f8f8f8;
	border-radius: 0.25em;
	font-family: monospace;
	font-size: 1.2em;
}

pre code {
	display: block;
	padding: 0.5em;
}

.page-break {
	page-break-after: always;
}

img {
	max-width: 100%;
	margin: 1em 0;
}

table {
	border-spacing: 0;
	border-collapse: collapse;
	display: block;
	margin: 0 0 1em;
	width: 100%;
	overflow: auto;
}

table th,
table td {
	padding: 0.5em 1em;
	border: 1px solid gainsboro;
}

table th {
	font-weight: 600;
}

table tr {
	background-color: white;
	border-top: 1px solid gainsboro;
}

table tr:nth-child(2n) {
	background-color: whitesmoke;
}
/*# sourceURL=C:\Users\omar\AppData\Local\Yarn\Data\global\node_modules\md-to-pdf\markdown.css*/</style><style type="text/css">pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}/*!
  Theme: GitHub
  Description: Light theme as seen on github.com
  Author: github.com
  Maintainer: @Hirse
  Updated: 2021-05-15

  Outdated base version: https://github.com/primer/github-syntax-light
  Current colors taken from GitHub's CSS
*/.hljs{color:#24292e;background:#fff}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#d73a49}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#6f42c1}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-variable{color:#005cc5}.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#032f62}.hljs-built_in,.hljs-symbol{color:#e36209}.hljs-code,.hljs-comment,.hljs-formula{color:#6a737d}.hljs-name,.hljs-quote,.hljs-selector-pseudo,.hljs-selector-tag{color:#22863a}.hljs-subst{color:#24292e}.hljs-section{color:#005cc5;font-weight:700}.hljs-bullet{color:#735c0f}.hljs-emphasis{color:#24292e;font-style:italic}.hljs-strong{color:#24292e;font-weight:700}.hljs-addition{color:#22863a;background-color:#f0fff4}.hljs-deletion{color:#b31d28;background-color:#ffeef0}/*# sourceURL=C:\Users\omar\AppData\Local\Yarn\Data\global\node_modules\highlight.js\styles\github.css*/</style></head>
	<body class="">
		<h1 id="csen604-databases-ii-project-report">CSEN604 Databases II Project Report</h1>
<h2 id="environment">Environment</h2>
<p>The queries were run on the following environment:</p>
<ul>
<li>PostgreSQL 14.3, compiled by Visual C++ build 1914, 64-bit</li>
<li>Windows 10 Version 21H2 (OS Build 19044.1706)</li>
<li>Processor AMD Ryzen 9 5900X 12-Core Processor</li>
<li>RAM 64 GB 3200 MHz</li>
</ul>
<p>No changes were made to the Postgres default configuration.</p>
<h2 id="schema-1">Schema 1</h2>
<h3 id="query-1">Query 1</h3>
<p>Display a list of all students in the CSEN department, along with the course sections, if any, that they 
        have taken in Semester 1 2019; all course sections from Spring 2019 must be displayed, even if no 
        student from the CSEN department has taken the course section.</p>
<pre><code class="hljs SQL"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span>
        <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span>
        <span class="hljs-keyword">from</span> student
        <span class="hljs-keyword">where</span>
        department <span class="hljs-operator">=</span> <span class="hljs-string">'CSEN'</span>) <span class="hljs-keyword">as</span> CS1_student
        <span class="hljs-keyword">full</span> <span class="hljs-keyword">outer</span> <span class="hljs-keyword">join</span>
        (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span>
        <span class="hljs-keyword">from</span> takes t <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> section s
        <span class="hljs-keyword">on</span> t.section_id <span class="hljs-operator">=</span> s.section_id
        <span class="hljs-keyword">where</span> semester <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">and</span>
        <span class="hljs-keyword">year</span> <span class="hljs-operator">=</span> <span class="hljs-number">2019</span>) <span class="hljs-keyword">as</span> sem1_student
        <span class="hljs-keyword">on</span> CS1_student.id <span class="hljs-operator">=</span> sem1_student.student_id
</code></pre>
<h4 id="without-any-optimization"><strong>Without Any Optimization</strong></h4>
<p>Query returns 136611 records</p>
<p><img src="./images/query_1_no_optimization.svg" alt="![Query 1 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
</tr>
</thead>
<tbody><tr>
<td>233.928ms</td>
<td>253.611ms</td>
<td>234.665ms</td>
<td>240.735ms</td>
<td>0.202ms</td>
<td>37451.36</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_student_btree" <span class="hljs-keyword">on</span> "student" <span class="hljs-keyword">using</span> btree ("department");
<span class="hljs-keyword">create</span> index "ix_section_btree" <span class="hljs-keyword">on</span> "section" <span class="hljs-keyword">using</span> btree ("semester", "year");
<span class="hljs-keyword">create</span> index "ix_takes_btree" <span class="hljs-keyword">on</span> "takes" <span class="hljs-keyword">using</span> btree ("section_id", "student_id");
</code></pre>
<p><img src="./images/query_1_btree.svg" alt="Query 1 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>103.546ms</td>
<td>74.385ms</td>
<td>68.097ms</td>
<td>82.009ms</td>
<td>0.257ms</td>
<td>33955.53</td>
<td>91%</td>
<td>34%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_student_hash" <span class="hljs-keyword">on</span> "student" <span class="hljs-keyword">using</span> hash ("department");
<span class="hljs-keyword">create</span> index "ix_section_hash" <span class="hljs-keyword">on</span> "section" <span class="hljs-keyword">using</span> hash ("year");
<span class="hljs-keyword">create</span> index "ix_takes_hash" <span class="hljs-keyword">on</span> "takes" <span class="hljs-keyword">using</span> hash ("student_id");
</code></pre>
<p><img src="./images/query_1_hash.svg" alt="Query 1 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>213.008ms</td>
<td>218.789ms</td>
<td>211.343ms</td>
<td>214.38ms</td>
<td>0.253ms</td>
<td>36145.62</td>
<td>97%</td>
<td>89%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_student_brin" <span class="hljs-keyword">on</span> "student" <span class="hljs-keyword">using</span> brin ("department");
<span class="hljs-keyword">create</span> index "ix_section_brin" <span class="hljs-keyword">on</span> "section" <span class="hljs-keyword">using</span> brin ("semester", "year");
<span class="hljs-keyword">create</span> index "ix_takes_brin" <span class="hljs-keyword">on</span> "takes" <span class="hljs-keyword">using</span> brin ("student_id");
</code></pre>
<p><img src="./images/query_1_brin.svg" alt="Query 1 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>219.42ms</td>
<td>219.346ms</td>
<td>211.564ms</td>
<td>216.777ms</td>
<td>0.208ms</td>
<td>36437.81</td>
<td>97%</td>
<td>90%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_student_hash" <span class="hljs-keyword">on</span> "student" <span class="hljs-keyword">using</span> hash ("department");
<span class="hljs-keyword">create</span> index "ix_section_btree" <span class="hljs-keyword">on</span> "section" <span class="hljs-keyword">using</span> btree ("semester", "year");
<span class="hljs-keyword">create</span> index "ix_takes_btree" <span class="hljs-keyword">on</span> "takes" <span class="hljs-keyword">using</span> btree ("section_id", "student_id");
</code></pre>
<p><img src="./images/query_1_mixed.svg" alt="Query 1 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>78.041ms</td>
<td>67.96ms</td>
<td>67.818ms</td>
<td>71.273ms</td>
<td>0.222ms</td>
<td>34779.02</td>
<td>93%</td>
<td>30%</td>
</tr>
</tbody></table>
<h4 id="improved-sql"><strong>Improved SQL</strong></h4>
<p>The original query had a flaw. 
        It was supposed to get all courses from Spring 2019 even if no CSEN student took the course. 
        However, since it was joining with <code>takes</code>, it would return the same course many times.
        For example, if 100 <em>non-CSEN</em> students took course, the course would be listed 100 times.
        Fixing the query significantly reduced the number of returned rows while maintaining the original requirement 
        and therefore had significant impact on execution time.</p>
<p><em><strong>We recommend creating B-Tree indices on <code>student</code> <code>section</code> and <code>takes</code> tables as indicated in the create index statements below.</strong></em></p>
<pre><code class="hljs SQL"><span class="hljs-keyword">with</span> s <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> section <span class="hljs-keyword">where</span> semester <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">year</span> <span class="hljs-operator">=</span> <span class="hljs-number">2019</span>),
        cs1_student <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> department <span class="hljs-operator">=</span> <span class="hljs-string">'CSEN'</span>),
        sem1_student <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> takes.<span class="hljs-operator">*</span>, s.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> takes <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> s <span class="hljs-keyword">on</span> takes.section_id <span class="hljs-operator">=</span> s.section_id <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> cs1_student <span class="hljs-keyword">on</span> cs1_student.id <span class="hljs-operator">=</span> takes.student_id)
        <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> cs1_student <span class="hljs-keyword">full</span> <span class="hljs-keyword">outer</span> <span class="hljs-keyword">join</span> sem1_student <span class="hljs-keyword">on</span> CS1_student.id <span class="hljs-operator">=</span> sem1_student.student_id;
</code></pre>
<h4 id="without-any-optimization-1"><strong>Without Any Optimization</strong></h4>
<p>Query returns 3242 records</p>
<p><img src="./images/query_1_improved_no_optimization.svg" alt="![Improved Query 1 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>20.399ms</td>
<td>19.095ms</td>
<td>19.003ms</td>
<td>19.499ms</td>
<td>0.32ms</td>
<td>33145.21</td>
<td>89%</td>
<td>8%</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-1"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_student_btree" <span class="hljs-keyword">on</span> "student" <span class="hljs-keyword">using</span> btree ("department");
<span class="hljs-keyword">create</span> index "ix_section_btree" <span class="hljs-keyword">on</span> "section" <span class="hljs-keyword">using</span> btree ("semester", "year");
<span class="hljs-keyword">create</span> index "ix_takes_btree" <span class="hljs-keyword">on</span> "takes" <span class="hljs-keyword">using</span> btree ("section_id", "student_id");
</code></pre>
<p><img src="./images/query_1_improved_btree.svg" alt="Improved Query 1 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>16.329ms</td>
<td>14.642ms</td>
<td>13.219ms</td>
<td>14.73ms</td>
<td>0.358ms</td>
<td>31240.8</td>
<td>94%</td>
<td>76%</td>
<td>92%</td>
<td>18%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-1"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_student_hash" <span class="hljs-keyword">on</span> "student" <span class="hljs-keyword">using</span> hash ("department");
<span class="hljs-keyword">create</span> index "ix_section_hash" <span class="hljs-keyword">on</span> "section" <span class="hljs-keyword">using</span> hash ("year");
<span class="hljs-keyword">create</span> index "ix_takes_hash" <span class="hljs-keyword">on</span> "takes" <span class="hljs-keyword">using</span> hash ("student_id");
</code></pre>
<p><img src="./images/query_1_improved_hash.svg" alt="Improved Query 1 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>15.23ms</td>
<td>12.724ms</td>
<td>13.37ms</td>
<td>13.775ms</td>
<td>0.292ms</td>
<td>32841.49</td>
<td>99%</td>
<td>71%</td>
<td>91%</td>
<td>6%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-1"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_student_brin" <span class="hljs-keyword">on</span> "student" <span class="hljs-keyword">using</span> brin ("department");
<span class="hljs-keyword">create</span> index "ix_section_brin" <span class="hljs-keyword">on</span> "section" <span class="hljs-keyword">using</span> brin ("semester", "year");
<span class="hljs-keyword">create</span> index "ix_takes_brin" <span class="hljs-keyword">on</span> "takes" <span class="hljs-keyword">using</span> brin ("student_id");
</code></pre>
<p><img src="./images/query_1_improved_brin.svg" alt="Improved Query 1 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>14.582ms</td>
<td>13.907ms</td>
<td>13.276ms</td>
<td>13.922ms</td>
<td>0.309ms</td>
<td>32878.83</td>
<td>99%</td>
<td>71%</td>
<td>90%</td>
<td>6%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-1"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_student_hash" <span class="hljs-keyword">on</span> "student" <span class="hljs-keyword">using</span> hash ("department");
<span class="hljs-keyword">create</span> index "ix_section_btree" <span class="hljs-keyword">on</span> "section" <span class="hljs-keyword">using</span> btree ("semester", "year");
<span class="hljs-keyword">create</span> index "ix_takes_btree" <span class="hljs-keyword">on</span> "takes" <span class="hljs-keyword">using</span> btree ("section_id", "student_id");
</code></pre>
<p><img src="./images/query_1_improved_mixed.svg" alt="Improved Query 1 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>13.069ms</td>
<td>12.574ms</td>
<td>13.676ms</td>
<td>13.106ms</td>
<td>0.368ms</td>
<td>31916.62</td>
<td>96%</td>
<td>67%</td>
<td>92%</td>
<td>18%</td>
</tr>
</tbody></table>
<h2 id="schema-2">Schema 2</h2>
<h3 id="query-2">Query 2</h3>
<p>Select all projects if employee with last name <code>'employee1'</code> is a manager of any department, otherwiser get projects employee with last name <code>'employee1'</code> is working on.</p>
<pre><code class="hljs SQL"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> pnumber 
        <span class="hljs-keyword">from</span> project 
        <span class="hljs-keyword">where</span> pnumber <span class="hljs-keyword">in</span>
        (<span class="hljs-keyword">select</span> pnumber 
            <span class="hljs-keyword">from</span> project, department d, employee e 
            <span class="hljs-keyword">where</span> e.dno <span class="hljs-operator">=</span> d.dnumber 
            <span class="hljs-keyword">and</span> d.mgr_snn <span class="hljs-operator">=</span> ssn 
            <span class="hljs-keyword">and</span> e.lname<span class="hljs-operator">=</span><span class="hljs-string">'employee1'</span> ) 
            <span class="hljs-keyword">or</span> pnumber <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> pno 
                <span class="hljs-keyword">from</span> works_on, employee 
                <span class="hljs-keyword">where</span> essn<span class="hljs-operator">=</span>ssn <span class="hljs-keyword">and</span> lname<span class="hljs-operator">=</span><span class="hljs-string">'employee1'</span> )
</code></pre>
<h4 id="without-any-optimization-2"><strong>Without Any Optimization</strong></h4>
<p>Query returns 600 records</p>
<p><img src="./images/query_2_no_optimization.svg" alt="![Query 2 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
</tr>
</thead>
<tbody><tr>
<td>7.236ms</td>
<td>5.013ms</td>
<td>4.648ms</td>
<td>5.632ms</td>
<td>0.328ms</td>
<td>1062.24</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-2"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_department_btree" <span class="hljs-keyword">on</span> "department" <span class="hljs-keyword">using</span> btree ("mgr_snn") include ("dnumber") ;
<span class="hljs-keyword">create</span> index "ix_employee_btree" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> btree ("lname") include ("dno") ;
<span class="hljs-keyword">create</span> index "ix_project_btree" <span class="hljs-keyword">on</span> "project" <span class="hljs-keyword">using</span> btree ("pnumber");
<span class="hljs-keyword">create</span> index "ix_works_on_btree" <span class="hljs-keyword">on</span> "works_on" <span class="hljs-keyword">using</span> btree ("essn") include ("pno") ;
</code></pre>
<p><img src="./images/query_2_btree.svg" alt="Query 2 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>4.064ms</td>
<td>3.951ms</td>
<td>3.784ms</td>
<td>3.933ms</td>
<td>0.364ms</td>
<td>607.54</td>
<td>57%</td>
<td>70%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-2"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_department_hash" <span class="hljs-keyword">on</span> "department" <span class="hljs-keyword">using</span> hash ("mgr_snn");
<span class="hljs-keyword">create</span> index "ix_employee_hash" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> hash ("lname");
<span class="hljs-keyword">create</span> index "ix_project_hash" <span class="hljs-keyword">on</span> "project" <span class="hljs-keyword">using</span> hash ("pnumber");
<span class="hljs-keyword">create</span> index "ix_works_on_hash" <span class="hljs-keyword">on</span> "works_on" <span class="hljs-keyword">using</span> hash ("essn");
</code></pre>
<p><img src="./images/query_2_hash.svg" alt="Query 2 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>3.809ms</td>
<td>3.879ms</td>
<td>3.773ms</td>
<td>3.82ms</td>
<td>0.287ms</td>
<td>607.25</td>
<td>57%</td>
<td>68%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-2"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_department_brin" <span class="hljs-keyword">on</span> "department" <span class="hljs-keyword">using</span> brin ("mgr_snn");
<span class="hljs-keyword">create</span> index "ix_employee_brin" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> brin ("lname");
<span class="hljs-keyword">create</span> index "ix_project_brin" <span class="hljs-keyword">on</span> "project" <span class="hljs-keyword">using</span> brin ("pnumber");
<span class="hljs-keyword">create</span> index "ix_works_on_brin" <span class="hljs-keyword">on</span> "works_on" <span class="hljs-keyword">using</span> brin ("essn");
</code></pre>
<p><img src="./images/query_2_brin.svg" alt="Query 2 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>4.625ms</td>
<td>5.178ms</td>
<td>4.549ms</td>
<td>4.784ms</td>
<td>0.326ms</td>
<td>1062.24</td>
<td>100%</td>
<td>85%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-2"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_department_btree" <span class="hljs-keyword">on</span> "department" <span class="hljs-keyword">using</span> btree ("mgr_snn");
<span class="hljs-keyword">create</span> index "ix_employee_hash" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> hash ("lname");
<span class="hljs-keyword">create</span> index "ix_project_hash" <span class="hljs-keyword">on</span> "project" <span class="hljs-keyword">using</span> hash ("pnumber");
<span class="hljs-keyword">create</span> index "ix_works_on_btree" <span class="hljs-keyword">on</span> "works_on" <span class="hljs-keyword">using</span> btree ("essn");
</code></pre>
<p><img src="./images/query_2_mixed.svg" alt="Query 2 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>3.983ms</td>
<td>3.845ms</td>
<td>3.987ms</td>
<td>3.938ms</td>
<td>0.351ms</td>
<td>607.25</td>
<td>57%</td>
<td>70%</td>
</tr>
</tbody></table>
<h4 id="improved-sql-1"><strong>Improved SQL</strong></h4>
<p>Table project is not used as condition at all in the first inner query of the original query,
         also the data from department or employee. The query output varies only by the count. 
         Hence we wrote improved query like that. The new query has better performance with and without indexes.</p>
<p><em><strong>We recommend creating B-Tree indices on <code>department</code>, <code>employee</code>, <code>works_on</code> and <code>project</code> tables as indicated in the create index statements below.</strong></em></p>
<pre><code class="hljs SQL"><span class="hljs-keyword">with</span> c <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) n <span class="hljs-keyword">from</span> employee e, department d <span class="hljs-keyword">where</span> mgr_snn <span class="hljs-operator">=</span> ssn <span class="hljs-keyword">and</span> dno <span class="hljs-operator">=</span> dnumber <span class="hljs-keyword">and</span> lname <span class="hljs-operator">=</span> <span class="hljs-string">'employee1'</span>)
    <span class="hljs-keyword">select</span> pnumber <span class="hljs-keyword">from</span> project 
    <span class="hljs-keyword">where</span> pnumber <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> pno <span class="hljs-keyword">as</span> pnumber <span class="hljs-keyword">from</span> works_on, employee <span class="hljs-keyword">where</span> essn<span class="hljs-operator">=</span>ssn <span class="hljs-keyword">and</span> lname <span class="hljs-operator">=</span> <span class="hljs-string">'employee1'</span>)
    <span class="hljs-keyword">or</span> (<span class="hljs-keyword">select</span> n <span class="hljs-keyword">from</span> c) <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-number">0</span>
</code></pre>
<h4 id="without-any-optimization-3"><strong>Without Any Optimization</strong></h4>
<p>Query returns 600 records</p>
<p><img src="./images/query_2_improved_no_optimization.svg" alt="![Improved Query 2 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>3.44ms</td>
<td>3.17ms</td>
<td>2.863ms</td>
<td>3.158ms</td>
<td>0.263ms</td>
<td>1210.12</td>
<td>114%</td>
<td>56%</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-3"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_department_btree" <span class="hljs-keyword">on</span> "department" <span class="hljs-keyword">using</span> btree ("mgr_snn") include ("dnumber") ;
<span class="hljs-keyword">create</span> index "ix_employee_btree" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> btree ("lname") include ("dno") ;
<span class="hljs-keyword">create</span> index "ix_project_btree" <span class="hljs-keyword">on</span> "project" <span class="hljs-keyword">using</span> btree ("pnumber");
<span class="hljs-keyword">create</span> index "ix_works_on_btree" <span class="hljs-keyword">on</span> "works_on" <span class="hljs-keyword">using</span> btree ("essn") include ("pno") ;
</code></pre>
<p><img src="./images/query_2_improved_btree.svg" alt="Improved Query 2 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>1.194ms</td>
<td>1.121ms</td>
<td>1.182ms</td>
<td>1.166ms</td>
<td>0.313ms</td>
<td>299.28</td>
<td>25%</td>
<td>37%</td>
<td>49%</td>
<td>30%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-3"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_department_hash" <span class="hljs-keyword">on</span> "department" <span class="hljs-keyword">using</span> hash ("mgr_snn");
<span class="hljs-keyword">create</span> index "ix_employee_hash" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> hash ("lname");
<span class="hljs-keyword">create</span> index "ix_project_hash" <span class="hljs-keyword">on</span> "project" <span class="hljs-keyword">using</span> hash ("pnumber");
<span class="hljs-keyword">create</span> index "ix_works_on_hash" <span class="hljs-keyword">on</span> "works_on" <span class="hljs-keyword">using</span> hash ("essn");
</code></pre>
<p><img src="./images/query_2_improved_hash.svg" alt="Improved Query 2 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>1.118ms</td>
<td>1.362ms</td>
<td>1.109ms</td>
<td>1.196ms</td>
<td>0.267ms</td>
<td>298.71</td>
<td>25%</td>
<td>38%</td>
<td>49%</td>
<td>31%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-3"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_department_brin" <span class="hljs-keyword">on</span> "department" <span class="hljs-keyword">using</span> brin ("mgr_snn");
<span class="hljs-keyword">create</span> index "ix_employee_brin" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> brin ("lname");
<span class="hljs-keyword">create</span> index "ix_project_brin" <span class="hljs-keyword">on</span> "project" <span class="hljs-keyword">using</span> brin ("pnumber");
<span class="hljs-keyword">create</span> index "ix_works_on_brin" <span class="hljs-keyword">on</span> "works_on" <span class="hljs-keyword">using</span> brin ("essn");
</code></pre>
<p><img src="./images/query_2_improved_brin.svg" alt="Improved Query 2 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>2.646ms</td>
<td>2.644ms</td>
<td>2.675ms</td>
<td>2.655ms</td>
<td>0.299ms</td>
<td>1200.31</td>
<td>99%</td>
<td>84%</td>
<td>113%</td>
<td>55%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-3"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_department_btree" <span class="hljs-keyword">on</span> "department" <span class="hljs-keyword">using</span> btree ("mgr_snn");
<span class="hljs-keyword">create</span> index "ix_employee_hash" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> hash ("lname");
<span class="hljs-keyword">create</span> index "ix_project_hash" <span class="hljs-keyword">on</span> "project" <span class="hljs-keyword">using</span> hash ("pnumber");
<span class="hljs-keyword">create</span> index "ix_works_on_btree" <span class="hljs-keyword">on</span> "works_on" <span class="hljs-keyword">using</span> btree ("essn");
</code></pre>
<p><img src="./images/query_2_improved_mixed.svg" alt="Improved Query 2 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>1.265ms</td>
<td>1.083ms</td>
<td>1.12ms</td>
<td>1.156ms</td>
<td>0.282ms</td>
<td>298.71</td>
<td>25%</td>
<td>37%</td>
<td>49%</td>
<td>29%</td>
</tr>
</tbody></table>
<h3 id="query-3">Query 3</h3>
<p>Select the names of employees whose salary is greater than the salary of all the employees in 
        department 5</p>
<pre><code class="hljs SQL"><span class="hljs-keyword">select</span> lname, fname 
        <span class="hljs-keyword">from</span> employee 
        <span class="hljs-keyword">where</span> salary <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">all</span> ( 
        <span class="hljs-keyword">select</span> salary 
        <span class="hljs-keyword">from</span> employee 
        <span class="hljs-keyword">where</span> dno<span class="hljs-operator">=</span><span class="hljs-number">5</span> )
</code></pre>
<h4 id="without-any-optimization-4"><strong>Without Any Optimization</strong></h4>
<p>Query returns 124 records</p>
<p><img src="./images/query_3_no_optimization.svg" alt="![Query 3 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
</tr>
</thead>
<tbody><tr>
<td>6.691ms</td>
<td>6.649ms</td>
<td>6.317ms</td>
<td>6.552ms</td>
<td>0.047ms</td>
<td>3711903</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-4"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_btree" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> btree ("salary");
<span class="hljs-keyword">create</span> index "ix_employee_btree2" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> btree ("dno") include ("salary") ;
</code></pre>
<p><img src="./images/query_3_btree.svg" alt="Query 3 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>5.837ms</td>
<td>5.73ms</td>
<td>5.642ms</td>
<td>5.736ms</td>
<td>0.069ms</td>
<td>57263.28</td>
<td>2%</td>
<td>88%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-4"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_hash" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> hash ("salary");
<span class="hljs-keyword">create</span> index "ix_employee_hash2" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> hash ("dno");
</code></pre>
<p><img src="./images/query_3_hash.svg" alt="Query 3 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>5.625ms</td>
<td>5.679ms</td>
<td>5.431ms</td>
<td>5.578ms</td>
<td>0.043ms</td>
<td>1750150.61</td>
<td>47%</td>
<td>85%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-4"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_brin" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> brin ("salary");
<span class="hljs-keyword">create</span> index "ix_employee_brin2" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> brin ("dno");
</code></pre>
<p><img src="./images/query_3_brin.svg" alt="Query 3 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>6.811ms</td>
<td>6.45ms</td>
<td>6.353ms</td>
<td>6.538ms</td>
<td>0.057ms</td>
<td>3711903</td>
<td>100%</td>
<td>100%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-4"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_brin" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> brin ("salary");
<span class="hljs-keyword">create</span> index "ix_employee_btree" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> btree ("dno") include ("salary") ;
</code></pre>
<p><img src="./images/query_3_mixed.svg" alt="Query 3 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>5.465ms</td>
<td>5.493ms</td>
<td>5.448ms</td>
<td>5.469ms</td>
<td>0.055ms</td>
<td>57263.28</td>
<td>2%</td>
<td>83%</td>
</tr>
</tbody></table>
<h4 id="improved-sql-2"><strong>Improved SQL</strong></h4>
<p>using <code>salary &gt; (select max(salary))</code> instead of <code>salary &gt; all</code> 
        yielded a drastically lower cost and execution time since the 
        query engine is comparing the salary with the maximum value instead of comparing with all values. 
        The improvement is noticed with and without using indices.</p>
<p><em><strong>We recommend creating B-Tree indices on <code>employee</code> table as indicated in the create index statements below.</strong></em></p>
<pre><code class="hljs SQL">
        <span class="hljs-keyword">select</span> lname, fname 
        <span class="hljs-keyword">from</span> employee 
        <span class="hljs-keyword">where</span> salary <span class="hljs-operator">&gt;</span> ( 
        <span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(salary)
        <span class="hljs-keyword">from</span> employee 
        <span class="hljs-keyword">where</span> dno<span class="hljs-operator">=</span><span class="hljs-number">5</span> )
        
</code></pre>
<h4 id="without-any-optimization-5"><strong>Without Any Optimization</strong></h4>
<p>Query returns 124 records</p>
<p><img src="./images/query_3_improved_no_optimization.svg" alt="![Improved Query 3 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>1.973ms</td>
<td>1.99ms</td>
<td>1.858ms</td>
<td>1.94ms</td>
<td>0.078ms</td>
<td>926.32</td>
<td>0%</td>
<td>30%</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-5"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_btree" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> btree ("salary");
<span class="hljs-keyword">create</span> index "ix_employee_btree2" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> btree ("dno") include ("salary") ;
</code></pre>
<p><img src="./images/query_3_improved_btree.svg" alt="Improved Query 3 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.272ms</td>
<td>0.097ms</td>
<td>0.109ms</td>
<td>0.159ms</td>
<td>0.107ms</td>
<td>438.05</td>
<td>47%</td>
<td>8%</td>
<td>1%</td>
<td>3%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-5"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_hash" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> hash ("salary");
<span class="hljs-keyword">create</span> index "ix_employee_hash2" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> hash ("dno");
</code></pre>
<p><img src="./images/query_3_improved_hash.svg" alt="Improved Query 3 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>1.198ms</td>
<td>1.075ms</td>
<td>1.02ms</td>
<td>1.098ms</td>
<td>0.09ms</td>
<td>686.06</td>
<td>74%</td>
<td>57%</td>
<td>0%</td>
<td>20%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-5"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_brin" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> brin ("salary");
<span class="hljs-keyword">create</span> index "ix_employee_brin2" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> brin ("dno");
</code></pre>
<p><img src="./images/query_3_improved_brin.svg" alt="Improved Query 3 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>2.118ms</td>
<td>2.036ms</td>
<td>1.848ms</td>
<td>2.001ms</td>
<td>0.111ms</td>
<td>926.32</td>
<td>100%</td>
<td>103%</td>
<td>0%</td>
<td>31%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-5"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_brin" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> brin ("salary");
<span class="hljs-keyword">create</span> index "ix_employee_btree" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> btree ("dno") include ("salary") ;
</code></pre>
<p><img src="./images/query_3_improved_mixed.svg" alt="Improved Query 3 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>1.109ms</td>
<td>1.281ms</td>
<td>1.135ms</td>
<td>1.175ms</td>
<td>0.101ms</td>
<td>469.77</td>
<td>51%</td>
<td>61%</td>
<td>1%</td>
<td>21%</td>
</tr>
</tbody></table>
<h3 id="query-4">Query 4</h3>
<p>Retrieve the name of each employee who has a dependent with the same first name and is the 
        same sex as the employee.</p>
<pre><code class="hljs SQL"><span class="hljs-keyword">select</span> e.fname, e.lname 
        <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">as</span> e 
        <span class="hljs-keyword">where</span> e.ssn <span class="hljs-keyword">in</span> ( 
        <span class="hljs-keyword">select</span> essn 
        <span class="hljs-keyword">from</span> dependent <span class="hljs-keyword">as</span> d 
        <span class="hljs-keyword">where</span> e.fname <span class="hljs-operator">=</span> d.dependent_name 
        <span class="hljs-keyword">and</span> 
        e.sex <span class="hljs-operator">=</span> d.sex )
</code></pre>
<h4 id="without-any-optimization-6"><strong>Without Any Optimization</strong></h4>
<p>Query returns 307 records</p>
<p><img src="./images/query_4_no_optimization.svg" alt="![Query 4 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
</tr>
</thead>
<tbody><tr>
<td>656.699ms</td>
<td>657.073ms</td>
<td>664.529ms</td>
<td>659.434ms</td>
<td>0.072ms</td>
<td>148483</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-6"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_btree" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> btree ("fname", "sex") include ("ssn") ;
<span class="hljs-keyword">create</span> index "ix_dependent_btree" <span class="hljs-keyword">on</span> "dependent" <span class="hljs-keyword">using</span> btree ("dependent_name", "sex", "essn");
</code></pre>
<p><img src="./images/query_4_btree.svg" alt="Query 4 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>39.03ms</td>
<td>38.726ms</td>
<td>38.333ms</td>
<td>38.696ms</td>
<td>0.085ms</td>
<td>69043</td>
<td>46%</td>
<td>6%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-6"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_hash" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> hash ("ssn");
<span class="hljs-keyword">create</span> index "ix_dependent_hash" <span class="hljs-keyword">on</span> "dependent" <span class="hljs-keyword">using</span> hash ("essn");
</code></pre>
<p><img src="./images/query_4_hash.svg" alt="Query 4 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>653.918ms</td>
<td>655.116ms</td>
<td>664.307ms</td>
<td>657.78ms</td>
<td>0.075ms</td>
<td>148483</td>
<td>100%</td>
<td>100%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-6"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_brin" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> brin ("ssn");
<span class="hljs-keyword">create</span> index "ix_dependent_brin" <span class="hljs-keyword">on</span> "dependent" <span class="hljs-keyword">using</span> brin ("dependent_name");
</code></pre>
<p><img src="./images/query_4_brin.svg" alt="Query 4 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>666.562ms</td>
<td>664.994ms</td>
<td>656.225ms</td>
<td>662.594ms</td>
<td>0.091ms</td>
<td>148483</td>
<td>100%</td>
<td>100%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-6"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_hash" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> hash ("ssn");
<span class="hljs-keyword">create</span> index "ix_dependent_btree" <span class="hljs-keyword">on</span> "dependent" <span class="hljs-keyword">using</span> btree ("dependent_name");
</code></pre>
<p><img src="./images/query_4_mixed.svg" alt="Query 4 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>37.198ms</td>
<td>37.211ms</td>
<td>37.086ms</td>
<td>37.165ms</td>
<td>0.108ms</td>
<td>69043</td>
<td>46%</td>
<td>6%</td>
</tr>
</tbody></table>
<h4 id="improved-sql-3"><strong>Improved SQL</strong></h4>
<p>The original query caused the Postgresql engine to
        scan the employee table as shown in query plan diagram above. 
        When chaning the query to use <code>exists</code> keyword instead of <code>in</code>, 
        the engine used another plan where it did a merge inner join 
        and an index scan instead of a table scan on employee table. 
        In both queries the dependent table is scanned, 
        but using the index in the merge inner join resulted in a better performance.</p>
<p><em><strong>We recommend creating B-Tree indices on <code>dependent</code> and <code>employee</code> tables as indicated in the create index statements below.</strong></em></p>
<pre><code class="hljs SQL"><span class="hljs-keyword">select</span> e.fname, e.lname 
        <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">as</span> e 
        <span class="hljs-keyword">where</span> <span class="hljs-keyword">EXISTS</span> ( 
        <span class="hljs-keyword">select</span> essn 
        <span class="hljs-keyword">from</span> dependent <span class="hljs-keyword">as</span> d 
        <span class="hljs-keyword">where</span> e.fname <span class="hljs-operator">=</span> d.dependent_name 
        <span class="hljs-keyword">and</span> 
        e.sex <span class="hljs-operator">=</span> d.sex <span class="hljs-keyword">and</span> d.essn <span class="hljs-operator">=</span> e.ssn)
</code></pre>
<h4 id="without-any-optimization-7"><strong>Without Any Optimization</strong></h4>
<p>Query returns 307 records</p>
<p><img src="./images/query_4_improved_no_optimization.svg" alt="![Improved Query 4 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.376ms</td>
<td>0.397ms</td>
<td>0.544ms</td>
<td>0.439ms</td>
<td>0.175ms</td>
<td>94.3</td>
<td>0%</td>
<td>0%</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-7"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_btree" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> btree ("fname", "sex") include ("ssn") ;
<span class="hljs-keyword">create</span> index "ix_dependent_btree" <span class="hljs-keyword">on</span> "dependent" <span class="hljs-keyword">using</span> btree ("dependent_name", "sex", "essn");
</code></pre>
<p><img src="./images/query_4_improved_btree.svg" alt="Improved Query 4 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.403ms</td>
<td>0.352ms</td>
<td>0.454ms</td>
<td>0.403ms</td>
<td>0.2ms</td>
<td>94.3</td>
<td>100%</td>
<td>92%</td>
<td>0%</td>
<td>1%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-7"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_hash" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> hash ("ssn");
<span class="hljs-keyword">create</span> index "ix_dependent_hash" <span class="hljs-keyword">on</span> "dependent" <span class="hljs-keyword">using</span> hash ("essn");
</code></pre>
<p><img src="./images/query_4_improved_hash.svg" alt="Improved Query 4 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.378ms</td>
<td>0.357ms</td>
<td>0.358ms</td>
<td>0.364ms</td>
<td>0.141ms</td>
<td>94.3</td>
<td>100%</td>
<td>83%</td>
<td>0%</td>
<td>0%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-7"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_brin" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> brin ("ssn");
<span class="hljs-keyword">create</span> index "ix_dependent_brin" <span class="hljs-keyword">on</span> "dependent" <span class="hljs-keyword">using</span> brin ("dependent_name");
</code></pre>
<p><img src="./images/query_4_improved_brin.svg" alt="Improved Query 4 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.383ms</td>
<td>0.386ms</td>
<td>0.366ms</td>
<td>0.378ms</td>
<td>0.162ms</td>
<td>94.3</td>
<td>100%</td>
<td>86%</td>
<td>0%</td>
<td>0%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-7"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_hash" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> hash ("ssn");
<span class="hljs-keyword">create</span> index "ix_dependent_btree" <span class="hljs-keyword">on</span> "dependent" <span class="hljs-keyword">using</span> btree ("dependent_name");
</code></pre>
<p><img src="./images/query_4_improved_mixed.svg" alt="Improved Query 4 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.382ms</td>
<td>0.39ms</td>
<td>0.384ms</td>
<td>0.385ms</td>
<td>0.179ms</td>
<td>94.3</td>
<td>100%</td>
<td>88%</td>
<td>0%</td>
<td>1%</td>
</tr>
</tbody></table>
<h3 id="query-5">Query 5</h3>
<p>Retrieve the names of employees who have dependents.</p>
<pre><code class="hljs SQL"><span class="hljs-keyword">select</span> fname, lname 
        <span class="hljs-keyword">from</span> employee 
        <span class="hljs-keyword">where</span> <span class="hljs-keyword">exists</span> ( <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> 
         <span class="hljs-keyword">from</span> dependent 
         <span class="hljs-keyword">where</span> ssn<span class="hljs-operator">=</span>essn )
</code></pre>
<h4 id="without-any-optimization-8"><strong>Without Any Optimization</strong></h4>
<p>Query returns 700 records</p>
<p><img src="./images/query_5_no_optimization.svg" alt="![Query 5 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
</tr>
</thead>
<tbody><tr>
<td>0.351ms</td>
<td>0.283ms</td>
<td>0.28ms</td>
<td>0.305ms</td>
<td>0.083ms</td>
<td>90.8</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-8"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_btree" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> btree ("ssn") include ("fname", "lname");
<span class="hljs-keyword">create</span> index "ix_dependent_btree" <span class="hljs-keyword">on</span> "dependent" <span class="hljs-keyword">using</span> btree ("essn");
</code></pre>
<p><img src="./images/query_5_btree.svg" alt="Query 5 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>0.268ms</td>
<td>0.379ms</td>
<td>0.245ms</td>
<td>0.297ms</td>
<td>0.114ms</td>
<td>78.75</td>
<td>87%</td>
<td>97%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-8"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_hash" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> hash ("ssn");
<span class="hljs-keyword">create</span> index "ix_dependent_hash" <span class="hljs-keyword">on</span> "dependent" <span class="hljs-keyword">using</span> hash ("essn");
</code></pre>
<p><img src="./images/query_5_hash.svg" alt="Query 5 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>0.3ms</td>
<td>0.308ms</td>
<td>0.284ms</td>
<td>0.297ms</td>
<td>0.1ms</td>
<td>90.8</td>
<td>100%</td>
<td>97%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-8"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_brin" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> brin ("ssn");
<span class="hljs-keyword">create</span> index "ix_dependent_brin" <span class="hljs-keyword">on</span> "dependent" <span class="hljs-keyword">using</span> brin ("essn");
</code></pre>
<p><img src="./images/query_5_brin.svg" alt="Query 5 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>0.446ms</td>
<td>0.41ms</td>
<td>0.3ms</td>
<td>0.385ms</td>
<td>0.137ms</td>
<td>90.8</td>
<td>100%</td>
<td>126%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-8"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_hash" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> hash ("ssn");
<span class="hljs-keyword">create</span> index "ix_dependent_btree" <span class="hljs-keyword">on</span> "dependent" <span class="hljs-keyword">using</span> btree ("essn");
</code></pre>
<p><img src="./images/query_5_mixed.svg" alt="Query 5 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>0.314ms</td>
<td>0.261ms</td>
<td>0.24ms</td>
<td>0.272ms</td>
<td>0.105ms</td>
<td>78.75</td>
<td>87%</td>
<td>89%</td>
</tr>
</tbody></table>
<h4 id="improved-sql-4"><strong>Improved SQL</strong></h4>
<p>We couldn't improve this query. 
        Here the data returned from dependents is not filtered unlike query 4.
        So the engine used merge semi join in both the cases here because merge joins are preferred when the data on both sides of the join is large.
        Therefore in query 5 changing between <code>in' and </code>exists` keywords had no effect while in query 4 it had. </p>
<p><em><strong>We recommend creating B-Tree indices on <code>dependent</code> and <code>employee</code> tables as indicated in the create index statements below.</strong></em></p>
<pre><code class="hljs SQL"><span class="hljs-keyword">select</span> fname, lname 
        <span class="hljs-keyword">from</span> employee 
        <span class="hljs-keyword">where</span> ssn <span class="hljs-keyword">in</span> ( <span class="hljs-keyword">select</span> essn 
         <span class="hljs-keyword">from</span> dependent 
         )
</code></pre>
<h4 id="without-any-optimization-9"><strong>Without Any Optimization</strong></h4>
<p>Query returns 700 records</p>
<p><img src="./images/query_5_improved_no_optimization.svg" alt="![Improved Query 5 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.385ms</td>
<td>0.287ms</td>
<td>0.296ms</td>
<td>0.323ms</td>
<td>0.11ms</td>
<td>90.8</td>
<td>100%</td>
<td>106%</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-9"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_btree" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> btree ("ssn") include ("fname", "lname");
<span class="hljs-keyword">create</span> index "ix_dependent_btree" <span class="hljs-keyword">on</span> "dependent" <span class="hljs-keyword">using</span> btree ("essn");
</code></pre>
<p><img src="./images/query_5_improved_btree.svg" alt="Improved Query 5 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.386ms</td>
<td>0.253ms</td>
<td>0.244ms</td>
<td>0.294ms</td>
<td>0.128ms</td>
<td>78.75</td>
<td>87%</td>
<td>91%</td>
<td>100%</td>
<td>99%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-9"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_hash" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> hash ("ssn");
<span class="hljs-keyword">create</span> index "ix_dependent_hash" <span class="hljs-keyword">on</span> "dependent" <span class="hljs-keyword">using</span> hash ("essn");
</code></pre>
<p><img src="./images/query_5_improved_hash.svg" alt="Improved Query 5 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.324ms</td>
<td>0.306ms</td>
<td>0.279ms</td>
<td>0.303ms</td>
<td>0.103ms</td>
<td>90.8</td>
<td>100%</td>
<td>94%</td>
<td>100%</td>
<td>102%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-9"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_brin" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> brin ("ssn");
<span class="hljs-keyword">create</span> index "ix_dependent_brin" <span class="hljs-keyword">on</span> "dependent" <span class="hljs-keyword">using</span> brin ("essn");
</code></pre>
<p><img src="./images/query_5_improved_brin.svg" alt="Improved Query 5 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.308ms</td>
<td>0.448ms</td>
<td>0.282ms</td>
<td>0.346ms</td>
<td>0.115ms</td>
<td>90.8</td>
<td>100%</td>
<td>107%</td>
<td>100%</td>
<td>90%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-9"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_hash" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> hash ("ssn");
<span class="hljs-keyword">create</span> index "ix_dependent_btree" <span class="hljs-keyword">on</span> "dependent" <span class="hljs-keyword">using</span> btree ("essn");
</code></pre>
<p><img src="./images/query_5_improved_mixed.svg" alt="Improved Query 5 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.268ms</td>
<td>0.246ms</td>
<td>0.24ms</td>
<td>0.251ms</td>
<td>0.098ms</td>
<td>78.75</td>
<td>87%</td>
<td>78%</td>
<td>100%</td>
<td>92%</td>
</tr>
</tbody></table>
<h3 id="query-6">Query 6</h3>
<p>For each department that has more than five employees, retrieve the department number and the 
        number of its employees who are making more than $40,000.</p>
<pre><code class="hljs SQL"><span class="hljs-keyword">select</span> dnumber, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) 
        <span class="hljs-keyword">from</span> department, employee 
        <span class="hljs-keyword">where</span> dnumber<span class="hljs-operator">=</span>dno 
        <span class="hljs-keyword">and</span> 
        salary <span class="hljs-operator">&gt;</span> <span class="hljs-number">40000</span> 
        <span class="hljs-keyword">and</span> 
        dno <span class="hljs-keyword">in</span> ( 
         <span class="hljs-keyword">select</span> dno 
         <span class="hljs-keyword">from</span> employee 
         <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> dno 
         <span class="hljs-keyword">having</span> <span class="hljs-built_in">count</span> (<span class="hljs-operator">*</span>) <span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span>) 
        <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> dnumber
</code></pre>
<h4 id="without-any-optimization-10"><strong>Without Any Optimization</strong></h4>
<p>Query returns 150 records</p>
<p><img src="./images/query_6_no_optimization.svg" alt="![Query 6 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
</tr>
</thead>
<tbody><tr>
<td>6.17ms</td>
<td>5.867ms</td>
<td>6.06ms</td>
<td>6.032ms</td>
<td>0.197ms</td>
<td>1009.39</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-10"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_btree" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> btree ("dno") include ("salary");
<span class="hljs-keyword">create</span> index "ix_department_btree" <span class="hljs-keyword">on</span> "department" <span class="hljs-keyword">using</span> btree ("dnumber");
</code></pre>
<p><img src="./images/query_6_btree.svg" alt="Query 6 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>3.78ms</td>
<td>3.205ms</td>
<td>3.512ms</td>
<td>3.499ms</td>
<td>0.27ms</td>
<td>732.65</td>
<td>73%</td>
<td>58%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-10"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_hash" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> hash ("dno");
<span class="hljs-keyword">create</span> index "ix_department_hash" <span class="hljs-keyword">on</span> "department" <span class="hljs-keyword">using</span> hash ("dnumber");
</code></pre>
<p><img src="./images/query_6_hash.svg" alt="Query 6 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>5.766ms</td>
<td>5.59ms</td>
<td>5.414ms</td>
<td>5.59ms</td>
<td>0.224ms</td>
<td>1009.39</td>
<td>100%</td>
<td>93%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-10"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_brin" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> brin ("dno");
<span class="hljs-keyword">create</span> index "ix_department_brin" <span class="hljs-keyword">on</span> "department" <span class="hljs-keyword">using</span> brin ("dnumber");
</code></pre>
<p><img src="./images/query_6_brin.svg" alt="Query 6 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>5.867ms</td>
<td>5.446ms</td>
<td>5.706ms</td>
<td>5.673ms</td>
<td>0.234ms</td>
<td>1009.39</td>
<td>100%</td>
<td>94%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-10"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_btree" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> btree ("dno") include ("salary");
<span class="hljs-keyword">create</span> index "ix_department_hash" <span class="hljs-keyword">on</span> "department" <span class="hljs-keyword">using</span> hash ("dnumber");
</code></pre>
<p><img src="./images/query_6_mixed.svg" alt="Query 6 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>3.551ms</td>
<td>3.207ms</td>
<td>3.19ms</td>
<td>3.316ms</td>
<td>0.237ms</td>
<td>732.65</td>
<td>73%</td>
<td>55%</td>
</tr>
</tbody></table>
<h4 id="improved-sql-5"><strong>Improved SQL</strong></h4>
<p>The original query used the <code>dnumber</code> column from <code>department</code> table and no other columns. 
        Since that column is already in the <code>employee</code> table, there is no need to include <code>department</code> table in the query.
        The improved query had a slightly lower cost because of that.</p>
<p><em><strong>We recommend creating B-Tree indices on <code>department</code> and <code>employee</code> tables as indicated in the create index statements below.</strong></em></p>
<pre><code class="hljs SQL"><span class="hljs-keyword">select</span> dno, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) 
    <span class="hljs-keyword">from</span> employee 
    <span class="hljs-keyword">where</span> salary <span class="hljs-operator">&gt;</span> <span class="hljs-number">40000</span> <span class="hljs-keyword">and</span> dno <span class="hljs-keyword">in</span> ( 
        <span class="hljs-keyword">select</span> dno 
        <span class="hljs-keyword">from</span> employee 
        <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> dno 
        <span class="hljs-keyword">having</span> <span class="hljs-built_in">count</span> (<span class="hljs-operator">*</span>) <span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span>) 
    <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> dno
</code></pre>
<h4 id="without-any-optimization-11"><strong>Without Any Optimization</strong></h4>
<p>Query returns 150 records</p>
<p><img src="./images/query_6_improved_no_optimization.svg" alt="![Improved Query 6 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>5.067ms</td>
<td>5.047ms</td>
<td>4.876ms</td>
<td>4.997ms</td>
<td>0.082ms</td>
<td>998.29</td>
<td>99%</td>
<td>83%</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-11"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_btree" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> btree ("dno") include ("salary");
<span class="hljs-keyword">create</span> index "ix_department_btree" <span class="hljs-keyword">on</span> "department" <span class="hljs-keyword">using</span> btree ("dnumber");
</code></pre>
<p><img src="./images/query_6_improved_btree.svg" alt="Improved Query 6 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>3.364ms</td>
<td>3.122ms</td>
<td>3.102ms</td>
<td>3.196ms</td>
<td>0.106ms</td>
<td>793.02</td>
<td>79%</td>
<td>64%</td>
<td>108%</td>
<td>91%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-11"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_hash" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> hash ("dno");
<span class="hljs-keyword">create</span> index "ix_department_hash" <span class="hljs-keyword">on</span> "department" <span class="hljs-keyword">using</span> hash ("dnumber");
</code></pre>
<p><img src="./images/query_6_improved_hash.svg" alt="Improved Query 6 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>4.987ms</td>
<td>5.01ms</td>
<td>4.883ms</td>
<td>4.96ms</td>
<td>0.106ms</td>
<td>998.29</td>
<td>100%</td>
<td>99%</td>
<td>99%</td>
<td>89%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-11"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_brin" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> brin ("dno");
<span class="hljs-keyword">create</span> index "ix_department_brin" <span class="hljs-keyword">on</span> "department" <span class="hljs-keyword">using</span> brin ("dnumber");
</code></pre>
<p><img src="./images/query_6_improved_brin.svg" alt="Improved Query 6 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>5.087ms</td>
<td>5.372ms</td>
<td>4.836ms</td>
<td>5.098ms</td>
<td>0.101ms</td>
<td>998.29</td>
<td>100%</td>
<td>102%</td>
<td>99%</td>
<td>90%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-11"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_employee_btree" <span class="hljs-keyword">on</span> "employee" <span class="hljs-keyword">using</span> btree ("dno") include ("salary");
<span class="hljs-keyword">create</span> index "ix_department_hash" <span class="hljs-keyword">on</span> "department" <span class="hljs-keyword">using</span> hash ("dnumber");
</code></pre>
<p><img src="./images/query_6_improved_mixed.svg" alt="Improved Query 6 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>3.291ms</td>
<td>3.122ms</td>
<td>3.311ms</td>
<td>3.241ms</td>
<td>0.111ms</td>
<td>793.02</td>
<td>79%</td>
<td>65%</td>
<td>108%</td>
<td>98%</td>
</tr>
</tbody></table>
<h2 id="schema-3">Schema 3</h2>
<h3 id="query-7">Query 7</h3>
<p>Find the names of sailors who have reserved boat 103.</p>
<pre><code class="hljs SQL"><span class="hljs-keyword">select</span> s.sname
        <span class="hljs-keyword">from</span> sailors s
        <span class="hljs-keyword">where</span>
        s.sid <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> r.sid
        <span class="hljs-keyword">from</span> reserves r
        <span class="hljs-keyword">where</span> r.bid <span class="hljs-operator">=</span> <span class="hljs-number">103</span>)
</code></pre>
<h4 id="without-any-optimization-12"><strong>Without Any Optimization</strong></h4>
<p>Query returns 705 records</p>
<p><img src="./images/query_7_no_optimization.svg" alt="![Query 7 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
</tr>
</thead>
<tbody><tr>
<td>4.894ms</td>
<td>3.003ms</td>
<td>2.999ms</td>
<td>3.632ms</td>
<td>0.133ms</td>
<td>1035.12</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-12"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_btree" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> btree ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_btree" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> btree ("bid");
</code></pre>
<p><img src="./images/query_7_btree.svg" alt="Query 7 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>2.196ms</td>
<td>2.073ms</td>
<td>2.076ms</td>
<td>2.115ms</td>
<td>0.195ms</td>
<td>615.84</td>
<td>59%</td>
<td>58%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-12"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_hash" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> hash ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_hash" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> hash ("bid");
</code></pre>
<p><img src="./images/query_7_hash.svg" alt="Query 7 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>2.235ms</td>
<td>2.021ms</td>
<td>1.891ms</td>
<td>2.049ms</td>
<td>0.136ms</td>
<td>623.42</td>
<td>60%</td>
<td>56%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-12"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_brin" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> brin ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_brin" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> brin ("bid");
</code></pre>
<p><img src="./images/query_7_brin.svg" alt="Query 7 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>3.347ms</td>
<td>3.534ms</td>
<td>3.105ms</td>
<td>3.329ms</td>
<td>0.147ms</td>
<td>1035.24</td>
<td>100%</td>
<td>92%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-12"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_hash" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> hash ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_btree" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> btree ("bid") include ("sid") ;
</code></pre>
<p><img src="./images/query_7_mixed.svg" alt="Query 7 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>2.068ms</td>
<td>1.967ms</td>
<td>1.933ms</td>
<td>1.989ms</td>
<td>0.192ms</td>
<td>428.39</td>
<td>41%</td>
<td>55%</td>
</tr>
</tbody></table>
<h4 id="improved-sql-6"><strong>Improved SQL</strong></h4>
<p>We couldn't optimize this query in terms of performance, but the inner join may be more readable.
        It's worth noting that inner join in this query doesn't affect the result vs using <code>in</code> keyword 
        because the <code>reserves</code> table has a primary key on <code>bid</code> and <code>sid</code>.</p>
<p><em><strong>We recommend creating B-Tree indices on <code>sailors</code> and <code>reserves</code> tables as indicated in the create index statements below.</strong></em></p>
<pre><code class="hljs SQL"><span class="hljs-keyword">select</span> s.sname
    <span class="hljs-keyword">from</span> sailors s
    <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> reserves r <span class="hljs-keyword">on</span> r.sid <span class="hljs-operator">=</span> s.sid <span class="hljs-keyword">where</span> r.bid <span class="hljs-operator">=</span> <span class="hljs-number">103</span>
    
</code></pre>
<h4 id="without-any-optimization-13"><strong>Without Any Optimization</strong></h4>
<p>Query returns 705 records</p>
<p><img src="./images/query_7_improved_no_optimization.svg" alt="![Improved Query 7 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>3.383ms</td>
<td>3.057ms</td>
<td>3.044ms</td>
<td>3.161ms</td>
<td>0.131ms</td>
<td>1035.12</td>
<td>100%</td>
<td>87%</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-13"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_btree" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> btree ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_btree" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> btree ("bid");
</code></pre>
<p><img src="./images/query_7_improved_btree.svg" alt="Improved Query 7 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>2.692ms</td>
<td>2.128ms</td>
<td>1.97ms</td>
<td>2.263ms</td>
<td>0.173ms</td>
<td>616.2</td>
<td>60%</td>
<td>72%</td>
<td>100%</td>
<td>107%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-13"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_hash" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> hash ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_hash" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> hash ("bid");
</code></pre>
<p><img src="./images/query_7_improved_hash.svg" alt="Improved Query 7 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>2.332ms</td>
<td>2.169ms</td>
<td>1.885ms</td>
<td>2.129ms</td>
<td>0.118ms</td>
<td>624.83</td>
<td>60%</td>
<td>67%</td>
<td>100%</td>
<td>104%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-13"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_brin" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> brin ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_brin" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> brin ("bid");
</code></pre>
<p><img src="./images/query_7_improved_brin.svg" alt="Improved Query 7 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>3.541ms</td>
<td>3.086ms</td>
<td>3.292ms</td>
<td>3.306ms</td>
<td>0.168ms</td>
<td>1035.3</td>
<td>100%</td>
<td>105%</td>
<td>100%</td>
<td>99%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-13"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_hash" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> hash ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_btree" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> btree ("bid") include ("sid") ;
</code></pre>
<p><img src="./images/query_7_improved_mixed.svg" alt="Improved Query 7 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>2.179ms</td>
<td>1.98ms</td>
<td>1.93ms</td>
<td>2.03ms</td>
<td>0.169ms</td>
<td>428.15</td>
<td>41%</td>
<td>64%</td>
<td>100%</td>
<td>102%</td>
</tr>
</tbody></table>
<h3 id="query-8">Query 8</h3>
<p>Find the names of sailors who have reserved a red boat.</p>
<pre><code class="hljs SQL"><span class="hljs-keyword">select</span> s.sname
    <span class="hljs-keyword">from</span> sailors s
            <span class="hljs-keyword">where</span> s.sid <span class="hljs-keyword">in</span> ( <span class="hljs-keyword">select</span> r.sid
            <span class="hljs-keyword">from</span> reserves r
            <span class="hljs-keyword">where</span> r. bid <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> b.bid
                <span class="hljs-keyword">from</span> boat b
                <span class="hljs-keyword">where</span> b.color <span class="hljs-operator">=</span> <span class="hljs-string">'red'</span>));
</code></pre>
<h4 id="without-any-optimization-14"><strong>Without Any Optimization</strong></h4>
<p>Query returns 3093 records</p>
<p><img src="./images/query_8_no_optimization.svg" alt="![Query 8 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
</tr>
</thead>
<tbody><tr>
<td>5.864ms</td>
<td>5.956ms</td>
<td>6.262ms</td>
<td>6.027ms</td>
<td>0.221ms</td>
<td>1192.95</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-14"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_btree" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> btree ("sid") include ("sname") ;
<span class="hljs-keyword">create</span> index "ix_reserves_btree" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> btree ("sid") include ("bid") ;
<span class="hljs-keyword">create</span> index "ix_boat_btree" <span class="hljs-keyword">on</span> "boat" <span class="hljs-keyword">using</span> btree ("color") include ("bid") ;
</code></pre>
<p><img src="./images/query_8_btree.svg" alt="Query 8 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>5.511ms</td>
<td>6.112ms</td>
<td>5.859ms</td>
<td>5.827ms</td>
<td>0.236ms</td>
<td>1143.98</td>
<td>96%</td>
<td>97%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-14"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_hash" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> hash ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_hash" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> hash ("bid");
<span class="hljs-keyword">create</span> index "ix_boat_hash" <span class="hljs-keyword">on</span> "boat" <span class="hljs-keyword">using</span> hash ("color");
</code></pre>
<p><img src="./images/query_8_hash.svg" alt="Query 8 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>7.137ms</td>
<td>6.372ms</td>
<td>5.974ms</td>
<td>6.494ms</td>
<td>0.26ms</td>
<td>951.94</td>
<td>80%</td>
<td>108%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-14"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_brin" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> brin ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_brin" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> brin ("bid");
<span class="hljs-keyword">create</span> index "ix_boat_brin" <span class="hljs-keyword">on</span> "boat" <span class="hljs-keyword">using</span> brin ("color");
</code></pre>
<p><img src="./images/query_8_brin.svg" alt="Query 8 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>6.828ms</td>
<td>6.155ms</td>
<td>5.782ms</td>
<td>6.255ms</td>
<td>0.196ms</td>
<td>1192.95</td>
<td>100%</td>
<td>104%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-14"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_brin" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> brin ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_hash" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> hash ("bid");
<span class="hljs-keyword">create</span> index "ix_boat_btree" <span class="hljs-keyword">on</span> "boat" <span class="hljs-keyword">using</span> btree ("color") include ("bid") ;
</code></pre>
<p><img src="./images/query_8_mixed.svg" alt="Query 8 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>5.877ms</td>
<td>5.992ms</td>
<td>5.491ms</td>
<td>5.787ms</td>
<td>0.269ms</td>
<td>1143.98</td>
<td>96%</td>
<td>96%</td>
</tr>
</tbody></table>
<h4 id="improved-sql-7"><strong>Improved SQL</strong></h4>
<p>We could not find a query with better performance, 
        but the improved query has better readablity because it has less nested queries.</p>
<p><em><strong>We recommend creating B-Tree indices on <code>boat</code>, <code>sailors</code> and <code>reserves</code> tables as indicated in the create index statements below.</strong></em></p>
<pre><code class="hljs SQL"><span class="hljs-keyword">select</span> s.sname <span class="hljs-keyword">from</span> sailors s 
    <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> reserves r <span class="hljs-keyword">on</span> r.sid <span class="hljs-operator">=</span> s.sid
    <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> boat b <span class="hljs-keyword">on</span> r.bid <span class="hljs-operator">=</span> b.bid
    <span class="hljs-keyword">where</span> b.color <span class="hljs-operator">=</span> <span class="hljs-string">'red'</span>
</code></pre>
<h4 id="without-any-optimization-15"><strong>Without Any Optimization</strong></h4>
<p>Query returns 3377 records</p>
<p><img src="./images/query_8_improved_no_optimization.svg" alt="![Improved Query 8 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>6.321ms</td>
<td>5.578ms</td>
<td>6.441ms</td>
<td>6.113ms</td>
<td>0.279ms</td>
<td>1268.51</td>
<td>106%</td>
<td>101%</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-15"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_btree" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> btree ("sid") include ("sname") ;
<span class="hljs-keyword">create</span> index "ix_reserves_btree" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> btree ("sid") include ("bid") ;
<span class="hljs-keyword">create</span> index "ix_boat_btree" <span class="hljs-keyword">on</span> "boat" <span class="hljs-keyword">using</span> btree ("color") include ("bid") ;
</code></pre>
<p><img src="./images/query_8_improved_btree.svg" alt="Improved Query 8 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>6.146ms</td>
<td>6.117ms</td>
<td>6.768ms</td>
<td>6.344ms</td>
<td>0.324ms</td>
<td>1219.54</td>
<td>96%</td>
<td>104%</td>
<td>107%</td>
<td>109%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-15"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_hash" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> hash ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_hash" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> hash ("bid");
<span class="hljs-keyword">create</span> index "ix_boat_hash" <span class="hljs-keyword">on</span> "boat" <span class="hljs-keyword">using</span> hash ("color");
</code></pre>
<p><img src="./images/query_8_improved_hash.svg" alt="Improved Query 8 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>5.998ms</td>
<td>6.51ms</td>
<td>5.771ms</td>
<td>6.093ms</td>
<td>0.279ms</td>
<td>826.08</td>
<td>65%</td>
<td>100%</td>
<td>87%</td>
<td>94%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-15"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_brin" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> brin ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_brin" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> brin ("bid");
<span class="hljs-keyword">create</span> index "ix_boat_brin" <span class="hljs-keyword">on</span> "boat" <span class="hljs-keyword">using</span> brin ("color");
</code></pre>
<p><img src="./images/query_8_improved_brin.svg" alt="Improved Query 8 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>6.182ms</td>
<td>5.836ms</td>
<td>6.172ms</td>
<td>6.063ms</td>
<td>0.274ms</td>
<td>1244.76</td>
<td>98%</td>
<td>99%</td>
<td>104%</td>
<td>97%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-15"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_brin" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> brin ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_hash" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> hash ("bid");
<span class="hljs-keyword">create</span> index "ix_boat_btree" <span class="hljs-keyword">on</span> "boat" <span class="hljs-keyword">using</span> btree ("color") include ("bid") ;
</code></pre>
<p><img src="./images/query_8_improved_mixed.svg" alt="Improved Query 8 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>5.661ms</td>
<td>5.681ms</td>
<td>5.814ms</td>
<td>5.719ms</td>
<td>0.277ms</td>
<td>1219.54</td>
<td>96%</td>
<td>94%</td>
<td>107%</td>
<td>99%</td>
</tr>
</tbody></table>
<h3 id="query-9">Query 9</h3>
<p>Find the names of sailors who have reserved both a red and a green boat.</p>
<pre><code class="hljs SQL"><span class="hljs-keyword">select</span> s.sname
        <span class="hljs-keyword">from</span> sailors s, reserves r, boat b
            <span class="hljs-keyword">where</span> s.sid <span class="hljs-operator">=</span> r.sid
            <span class="hljs-keyword">and</span>
            r.bid <span class="hljs-operator">=</span> b.bid
            <span class="hljs-keyword">and</span>
            b.color <span class="hljs-operator">=</span> <span class="hljs-string">'red'</span>
            <span class="hljs-keyword">and</span>
            s.sid <span class="hljs-keyword">in</span> ( <span class="hljs-keyword">select</span> s2.sid <span class="hljs-keyword">from</span> sailors s2, boat b2, reserves r2  <span class="hljs-keyword">where</span> s2.sid <span class="hljs-operator">=</span> r2.sid
                <span class="hljs-keyword">and</span> r2.bid <span class="hljs-operator">=</span> b2.bid
                <span class="hljs-keyword">and</span> b2.color <span class="hljs-operator">=</span> <span class="hljs-string">'green'</span>);
        
</code></pre>
<h4 id="without-any-optimization-16"><strong>Without Any Optimization</strong></h4>
<p>Query returns 539 records</p>
<p><img src="./images/query_9_no_optimization.svg" alt="![Query 9 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
</tr>
</thead>
<tbody><tr>
<td>11.433ms</td>
<td>10.819ms</td>
<td>10.187ms</td>
<td>10.813ms</td>
<td>0.682ms</td>
<td>2286.27</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-16"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_btree" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> btree ("sid") include ("sname") ;
<span class="hljs-keyword">create</span> index "ix_reserves_btree" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> btree ("bid") include ("sid") ;
<span class="hljs-keyword">create</span> index "ix_boat_btree" <span class="hljs-keyword">on</span> "boat" <span class="hljs-keyword">using</span> btree ("color") include ("bid") ;
</code></pre>
<p><img src="./images/query_9_btree.svg" alt="Query 9 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>6.189ms</td>
<td>5.644ms</td>
<td>5.054ms</td>
<td>5.629ms</td>
<td>0.785ms</td>
<td>2065.73</td>
<td>90%</td>
<td>52%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-16"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_hash" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> hash ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_hash" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> hash ("bid");
<span class="hljs-keyword">create</span> index "ix_boat_hash" <span class="hljs-keyword">on</span> "boat" <span class="hljs-keyword">using</span> hash ("color");
</code></pre>
<p><img src="./images/query_9_hash.svg" alt="Query 9 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>11.818ms</td>
<td>11.018ms</td>
<td>10.404ms</td>
<td>11.08ms</td>
<td>0.788ms</td>
<td>1635.87</td>
<td>72%</td>
<td>102%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-16"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_brin" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> brin ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_brin" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> brin ("bid");
<span class="hljs-keyword">create</span> index "ix_boat_brin" <span class="hljs-keyword">on</span> "boat" <span class="hljs-keyword">using</span> brin ("color");
</code></pre>
<p><img src="./images/query_9_brin.svg" alt="Query 9 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>12.169ms</td>
<td>10.694ms</td>
<td>10.808ms</td>
<td>11.224ms</td>
<td>0.731ms</td>
<td>2286.27</td>
<td>100%</td>
<td>104%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-16"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_btree" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> btree ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_btree" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> btree ("bid") include ("sid") ;
<span class="hljs-keyword">create</span> index "ix_boat_btree" <span class="hljs-keyword">on</span> "boat" <span class="hljs-keyword">using</span> btree ("color") include ("bid") ;
</code></pre>
<p><img src="./images/query_9_mixed.svg" alt="Query 9 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>5.915ms</td>
<td>5.254ms</td>
<td>5.825ms</td>
<td>5.665ms</td>
<td>0.815ms</td>
<td>2072.81</td>
<td>91%</td>
<td>52%</td>
</tr>
</tbody></table>
<h4 id="improved-sql-8"><strong>Improved SQL</strong></h4>
<p>Using CTEs not only made the query more readable, 
        but also caused a small improvement in cost and time of the query.</p>
<p><em><strong>We recommend creating B-Tree indices on <code>boat</code>, <code>sailors</code> and <code>reserves</code> tables as indicated in the create index statements below.</strong></em></p>
<pre><code class="hljs SQL"><span class="hljs-keyword">with</span> bgreen <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> bid <span class="hljs-keyword">from</span> boat <span class="hljs-keyword">where</span> color <span class="hljs-operator">=</span> <span class="hljs-string">'green'</span>),
        bred <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> bid <span class="hljs-keyword">from</span> boat <span class="hljs-keyword">where</span> color <span class="hljs-operator">=</span> <span class="hljs-string">'red'</span>),
        rgreen <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> sid <span class="hljs-keyword">from</span> reserves <span class="hljs-keyword">where</span> bid <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> bid <span class="hljs-keyword">from</span> bgreen)),
        rred <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> sid <span class="hljs-keyword">from</span> reserves <span class="hljs-keyword">where</span> bid <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> bid <span class="hljs-keyword">from</span> bred))
        <span class="hljs-keyword">select</span> sname <span class="hljs-keyword">from</span> sailors <span class="hljs-keyword">where</span> sid <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> sid <span class="hljs-keyword">from</span> rgreen <span class="hljs-keyword">intersect</span> <span class="hljs-keyword">select</span> sid <span class="hljs-keyword">from</span> rred)
        
</code></pre>
<h4 id="without-any-optimization-17"><strong>Without Any Optimization</strong></h4>
<p>Query returns 490 records</p>
<p><img src="./images/query_9_improved_no_optimization.svg" alt="![Improved Query 9 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>9.852ms</td>
<td>9.333ms</td>
<td>9.144ms</td>
<td>9.443ms</td>
<td>0.224ms</td>
<td>1996.65</td>
<td>87%</td>
<td>87%</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-17"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_btree" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> btree ("sid") include ("sname") ;
<span class="hljs-keyword">create</span> index "ix_reserves_btree" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> btree ("bid") include ("sid") ;
<span class="hljs-keyword">create</span> index "ix_boat_btree" <span class="hljs-keyword">on</span> "boat" <span class="hljs-keyword">using</span> btree ("color") include ("bid") ;
</code></pre>
<p><img src="./images/query_9_improved_btree.svg" alt="Improved Query 9 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>4.178ms</td>
<td>4.333ms</td>
<td>4.305ms</td>
<td>4.272ms</td>
<td>0.383ms</td>
<td>1783.2</td>
<td>89%</td>
<td>45%</td>
<td>86%</td>
<td>76%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-17"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_hash" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> hash ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_hash" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> hash ("bid");
<span class="hljs-keyword">create</span> index "ix_boat_hash" <span class="hljs-keyword">on</span> "boat" <span class="hljs-keyword">using</span> hash ("color");
</code></pre>
<p><img src="./images/query_9_improved_hash.svg" alt="Improved Query 9 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>9.598ms</td>
<td>8.895ms</td>
<td>9.168ms</td>
<td>9.22ms</td>
<td>0.263ms</td>
<td>1949.8</td>
<td>98%</td>
<td>98%</td>
<td>119%</td>
<td>83%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-17"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_brin" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> brin ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_brin" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> brin ("bid");
<span class="hljs-keyword">create</span> index "ix_boat_brin" <span class="hljs-keyword">on</span> "boat" <span class="hljs-keyword">using</span> brin ("color");
</code></pre>
<p><img src="./images/query_9_improved_brin.svg" alt="Improved Query 9 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>10.596ms</td>
<td>9.751ms</td>
<td>10.165ms</td>
<td>10.171ms</td>
<td>0.311ms</td>
<td>1996.65</td>
<td>100%</td>
<td>108%</td>
<td>87%</td>
<td>91%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-17"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_sailors_btree" <span class="hljs-keyword">on</span> "sailors" <span class="hljs-keyword">using</span> btree ("sid");
<span class="hljs-keyword">create</span> index "ix_reserves_btree" <span class="hljs-keyword">on</span> "reserves" <span class="hljs-keyword">using</span> btree ("bid") include ("sid") ;
<span class="hljs-keyword">create</span> index "ix_boat_btree" <span class="hljs-keyword">on</span> "boat" <span class="hljs-keyword">using</span> btree ("color") include ("bid") ;
</code></pre>
<p><img src="./images/query_9_improved_mixed.svg" alt="Improved Query 9 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>4.154ms</td>
<td>4.321ms</td>
<td>3.923ms</td>
<td>4.133ms</td>
<td>0.307ms</td>
<td>1783.2</td>
<td>89%</td>
<td>44%</td>
<td>86%</td>
<td>73%</td>
</tr>
</tbody></table>
<h2 id="schema-4">Schema 4</h2>
<h3 id="query-10">Query 10</h3>
<p>List all the information of the actors who played a role in the movie 'Annie Hall'.</p>
<pre><code class="hljs SQL"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> 
        <span class="hljs-keyword">from</span> actor 
            <span class="hljs-keyword">where</span> act_id <span class="hljs-keyword">in</span> ( 
                <span class="hljs-keyword">select</span> act_id 
                    <span class="hljs-keyword">from</span> movie_cast 
                    <span class="hljs-keyword">where</span> mov_id <span class="hljs-keyword">in</span>( 
                        <span class="hljs-keyword">select</span> mov_id 
                        <span class="hljs-keyword">from</span> movie 
                        <span class="hljs-keyword">where</span> mov_title <span class="hljs-operator">=</span><span class="hljs-string">'Annie Hall'</span>
                    )
            )
        
</code></pre>
<h4 id="without-any-optimization-18"><strong>Without Any Optimization</strong></h4>
<p>Query returns 374 records</p>
<p><img src="./images/query_10_no_optimization.svg" alt="![Query 10 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
</tr>
</thead>
<tbody><tr>
<td>34.609ms</td>
<td>30.28ms</td>
<td>29.901ms</td>
<td>31.597ms</td>
<td>0.2ms</td>
<td>3503.52</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-18"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_cast_btree" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> btree ("mov_id") include ("act_id") ;
<span class="hljs-keyword">create</span> index "ix_movie_btree" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> btree ("mov_title") include ("mov_id") ;
<span class="hljs-keyword">create</span> index "ix_actor_btree" <span class="hljs-keyword">on</span> "actor" <span class="hljs-keyword">using</span> btree ("act_id");
</code></pre>
<p><img src="./images/query_10_btree.svg" alt="Query 10 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>0.574ms</td>
<td>0.662ms</td>
<td>0.681ms</td>
<td>0.639ms</td>
<td>0.268ms</td>
<td>46.44</td>
<td>1%</td>
<td>2%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-18"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_cast_hash" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> hash ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_hash" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> hash ("mov_title");
<span class="hljs-keyword">create</span> index "ix_actor_hash" <span class="hljs-keyword">on</span> "actor" <span class="hljs-keyword">using</span> hash ("act_id");
</code></pre>
<p><img src="./images/query_10_hash.svg" alt="Query 10 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>0.683ms</td>
<td>0.583ms</td>
<td>0.603ms</td>
<td>0.623ms</td>
<td>0.216ms</td>
<td>766.47</td>
<td>22%</td>
<td>2%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-18"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_cast_brin" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> brin ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_brin" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> brin ("mov_title");
<span class="hljs-keyword">create</span> index "ix_actor_brin" <span class="hljs-keyword">on</span> "actor" <span class="hljs-keyword">using</span> brin ("act_id");
</code></pre>
<p><img src="./images/query_10_brin.svg" alt="Query 10 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>33.628ms</td>
<td>29.69ms</td>
<td>29.976ms</td>
<td>31.098ms</td>
<td>0.32ms</td>
<td>3503.51</td>
<td>100%</td>
<td>98%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-18"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_cast_hash" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> hash ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_hash" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> hash ("mov_title");
<span class="hljs-keyword">create</span> index "ix_actor_btree" <span class="hljs-keyword">on</span> "actor" <span class="hljs-keyword">using</span> btree ("act_id");
</code></pre>
<p><img src="./images/query_10_mixed.svg" alt="Query 10 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>0.666ms</td>
<td>0.665ms</td>
<td>0.575ms</td>
<td>0.635ms</td>
<td>0.171ms</td>
<td>766.45</td>
<td>22%</td>
<td>2%</td>
</tr>
</tbody></table>
<h4 id="improved-sql-9"><strong>Improved SQL</strong></h4>
<p>The improved query used simple inner joins 
        which made the query plan simpler in case of using no indexes even though the cost is similar.
        However, when using B-Tree indices, the cost and the execution time of the improved query are lower.
        The use of inner joins is possible for this query because <code>movie_cast</code> 
        table has a primary key on both <code>act_id</code> and <code>mov_id</code> columns, so the output of the query won't change vs 
        using <code>in</code> keyword.</p>
<p><em><strong>We recommend creating B-Tree indices on <code>movie_cast</code>, <code>movie_</code> and <code>actor</code> tables as indicated in the create index statements below.</strong></em></p>
<pre><code class="hljs SQL"><span class="hljs-keyword">select</span> a.<span class="hljs-operator">*</span> 
    <span class="hljs-keyword">from</span> actor a
    <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> movie_cast mc <span class="hljs-keyword">on</span> mc.act_id <span class="hljs-operator">=</span> a.act_id
    <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> movie m <span class="hljs-keyword">on</span> m.mov_id <span class="hljs-operator">=</span> mc.mov_id
    <span class="hljs-keyword">where</span> m.mov_title <span class="hljs-operator">=</span> <span class="hljs-string">'Annie Hall'</span>            
        
</code></pre>
<h4 id="without-any-optimization-19"><strong>Without Any Optimization</strong></h4>
<p>Query returns 374 records</p>
<p><img src="./images/query_10_improved_no_optimization.svg" alt="![Improved Query 10 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>26.338ms</td>
<td>21.758ms</td>
<td>23.94ms</td>
<td>24.012ms</td>
<td>0.268ms</td>
<td>3499.48</td>
<td>100%</td>
<td>76%</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-19"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_cast_btree" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> btree ("mov_id") include ("act_id") ;
<span class="hljs-keyword">create</span> index "ix_movie_btree" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> btree ("mov_title") include ("mov_id") ;
<span class="hljs-keyword">create</span> index "ix_actor_btree" <span class="hljs-keyword">on</span> "actor" <span class="hljs-keyword">using</span> btree ("act_id");
</code></pre>
<p><img src="./images/query_10_improved_btree.svg" alt="Improved Query 10 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.48ms</td>
<td>0.567ms</td>
<td>0.362ms</td>
<td>0.47ms</td>
<td>0.295ms</td>
<td>42.41</td>
<td>1%</td>
<td>2%</td>
<td>91%</td>
<td>74%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-19"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_cast_hash" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> hash ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_hash" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> hash ("mov_title");
<span class="hljs-keyword">create</span> index "ix_actor_hash" <span class="hljs-keyword">on</span> "actor" <span class="hljs-keyword">using</span> hash ("act_id");
</code></pre>
<p><img src="./images/query_10_improved_hash.svg" alt="Improved Query 10 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.892ms</td>
<td>0.817ms</td>
<td>0.782ms</td>
<td>0.83ms</td>
<td>0.264ms</td>
<td>762.18</td>
<td>22%</td>
<td>3%</td>
<td>99%</td>
<td>133%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-19"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_cast_brin" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> brin ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_brin" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> brin ("mov_title");
<span class="hljs-keyword">create</span> index "ix_actor_brin" <span class="hljs-keyword">on</span> "actor" <span class="hljs-keyword">using</span> brin ("act_id");
</code></pre>
<p><img src="./images/query_10_improved_brin.svg" alt="Improved Query 10 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>25.339ms</td>
<td>25.844ms</td>
<td>22.012ms</td>
<td>24.398ms</td>
<td>0.248ms</td>
<td>3499.48</td>
<td>100%</td>
<td>102%</td>
<td>100%</td>
<td>78%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-19"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_cast_hash" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> hash ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_hash" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> hash ("mov_title");
<span class="hljs-keyword">create</span> index "ix_actor_btree" <span class="hljs-keyword">on</span> "actor" <span class="hljs-keyword">using</span> btree ("act_id");
</code></pre>
<p><img src="./images/query_10_improved_mixed.svg" alt="Improved Query 10 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.744ms</td>
<td>0.611ms</td>
<td>0.534ms</td>
<td>0.63ms</td>
<td>0.31ms</td>
<td>762.47</td>
<td>22%</td>
<td>3%</td>
<td>99%</td>
<td>99%</td>
</tr>
</tbody></table>
<h3 id="query-11">Query 11</h3>
<p>Find the name of the director (first and last names) who directed a movie that casted a role for 
        'Eyes Wide Shut'</p>
<pre><code class="hljs SQL"><span class="hljs-keyword">select</span> dir_fname, dir_lname 
    <span class="hljs-keyword">from</span> director 
    <span class="hljs-keyword">where</span> dir_id <span class="hljs-keyword">in</span>( 
        <span class="hljs-keyword">select</span> dir_id 
            <span class="hljs-keyword">from</span> movie_direction 
            <span class="hljs-keyword">where</span> mov_id <span class="hljs-keyword">in</span>( 
                <span class="hljs-keyword">select</span> mov_id 
                    <span class="hljs-keyword">from</span> movie_cast 
                    <span class="hljs-keyword">where</span> role <span class="hljs-operator">=</span><span class="hljs-keyword">any</span>(
                        <span class="hljs-keyword">select</span> role 
                            <span class="hljs-keyword">from</span> movie_cast 
                            <span class="hljs-keyword">where</span> mov_id <span class="hljs-keyword">in</span>( 
                                <span class="hljs-keyword">select</span> mov_id 
                                    <span class="hljs-keyword">from</span> movie 
                                    <span class="hljs-keyword">where</span> mov_title<span class="hljs-operator">=</span><span class="hljs-string">'Eyes Wide Shut'</span>
                                )
                        )
                )
            )
        
</code></pre>
<h4 id="without-any-optimization-20"><strong>Without Any Optimization</strong></h4>
<p>Query returns 5 records</p>
<p><img src="./images/query_11_no_optimization.svg" alt="![Query 11 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
</tr>
</thead>
<tbody><tr>
<td>24.917ms</td>
<td>24.285ms</td>
<td>27.245ms</td>
<td>25.482ms</td>
<td>0.401ms</td>
<td>5400.02</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-20"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_direction_btree" <span class="hljs-keyword">on</span> "movie_direction" <span class="hljs-keyword">using</span> btree ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_cast_btree" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> btree ("mov_id") include ("role") ;
<span class="hljs-keyword">create</span> index "ix_movie_cast_btree2" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> btree ("role") include ("mov_id") ;
<span class="hljs-keyword">create</span> index "ix_movie_btree" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> btree ("mov_title") include ("mov_id") ;
<span class="hljs-keyword">create</span> index "ix_director_btree" <span class="hljs-keyword">on</span> "director" <span class="hljs-keyword">using</span> btree ("dir_id");
</code></pre>
<p><img src="./images/query_11_btree.svg" alt="Query 11 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>0.871ms</td>
<td>0.825ms</td>
<td>0.792ms</td>
<td>0.829ms</td>
<td>0.542ms</td>
<td>146.16</td>
<td>3%</td>
<td>3%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-20"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_direction_hash" <span class="hljs-keyword">on</span> "movie_direction" <span class="hljs-keyword">using</span> hash ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_cast_hash" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> hash ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_hash" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> hash ("mov_title");
<span class="hljs-keyword">create</span> index "ix_director_hash" <span class="hljs-keyword">on</span> "director" <span class="hljs-keyword">using</span> hash ("dir_id");
</code></pre>
<p><img src="./images/query_11_hash.svg" alt="Query 11 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>8.183ms</td>
<td>9.489ms</td>
<td>8.35ms</td>
<td>8.674ms</td>
<td>0.501ms</td>
<td>2515.91</td>
<td>47%</td>
<td>34%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-20"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_direction_brin" <span class="hljs-keyword">on</span> "movie_direction" <span class="hljs-keyword">using</span> brin ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_cast_brin" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> brin ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_brin" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> brin ("mov_title");
<span class="hljs-keyword">create</span> index "ix_director_brin" <span class="hljs-keyword">on</span> "director" <span class="hljs-keyword">using</span> brin ("dir_id");
</code></pre>
<p><img src="./images/query_11_brin.svg" alt="Query 11 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>25.089ms</td>
<td>24.547ms</td>
<td>24.23ms</td>
<td>24.622ms</td>
<td>0.45ms</td>
<td>5400.02</td>
<td>100%</td>
<td>97%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-20"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_direction_btree" <span class="hljs-keyword">on</span> "movie_direction" <span class="hljs-keyword">using</span> btree ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_cast_btree" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> btree ("mov_id") include ("role") ;
<span class="hljs-keyword">create</span> index "ix_movie_cast_btree2" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> btree ("role") include ("mov_id") ;
<span class="hljs-keyword">create</span> index "ix_movie_hash" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> hash ("mov_title");
<span class="hljs-keyword">create</span> index "ix_director_hash" <span class="hljs-keyword">on</span> "director" <span class="hljs-keyword">using</span> hash ("dir_id");
</code></pre>
<p><img src="./images/query_11_mixed.svg" alt="Query 11 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>0.868ms</td>
<td>0.782ms</td>
<td>0.892ms</td>
<td>0.847ms</td>
<td>0.508ms</td>
<td>120.26</td>
<td>2%</td>
<td>3%</td>
</tr>
</tbody></table>
<h4 id="improved-sql-10"><strong>Improved SQL</strong></h4>
<p>THE CTE and the joins made the improved query more readable, 
        and a small reduction of the query cost and time when using B-Tree indices 
        since there 2 more aggregate steps in the original query's plan.</p>
<p><em><strong>We recommend creating B-Tree indices on <code>movie_cast</code>, <code>movie</code>, <code>movie_direction</code> and <code>director</code> tables as indicated in the create index statements below.</strong></em></p>
<pre><code class="hljs SQL"><span class="hljs-keyword">WITH</span> movs <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> mc2.mov_id <span class="hljs-keyword">from</span>
            movie m
            <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> movie_cast mc
            <span class="hljs-keyword">on</span> m.mov_id <span class="hljs-operator">=</span> mc.mov_id 
            <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> movie_cast mc2 <span class="hljs-keyword">on</span> mc2.role <span class="hljs-operator">=</span> mc.role
            <span class="hljs-keyword">where</span> mov_title <span class="hljs-operator">=</span> <span class="hljs-string">'Eyes Wide Shut'</span>
            )
        <span class="hljs-keyword">select</span> dir_fname, dir_lname
    <span class="hljs-keyword">from</span> director d
    <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> movie_direction md 
    <span class="hljs-keyword">on</span> md.dir_id <span class="hljs-operator">=</span> d.dir_id
    <span class="hljs-keyword">where</span> mov_id <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> mov_id <span class="hljs-keyword">from</span> movs)
</code></pre>
<h4 id="without-any-optimization-21"><strong>Without Any Optimization</strong></h4>
<p>Query returns 5 records</p>
<p><img src="./images/query_11_improved_no_optimization.svg" alt="![Improved Query 11 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>25.026ms</td>
<td>25.526ms</td>
<td>25.819ms</td>
<td>25.457ms</td>
<td>0.465ms</td>
<td>5488.58</td>
<td>102%</td>
<td>100%</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-21"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_direction_btree" <span class="hljs-keyword">on</span> "movie_direction" <span class="hljs-keyword">using</span> btree ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_cast_btree" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> btree ("mov_id") include ("role") ;
<span class="hljs-keyword">create</span> index "ix_movie_cast_btree2" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> btree ("role") include ("mov_id") ;
<span class="hljs-keyword">create</span> index "ix_movie_btree" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> btree ("mov_title") include ("mov_id") ;
<span class="hljs-keyword">create</span> index "ix_director_btree" <span class="hljs-keyword">on</span> "director" <span class="hljs-keyword">using</span> btree ("dir_id");
</code></pre>
<p><img src="./images/query_11_improved_btree.svg" alt="Improved Query 11 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.848ms</td>
<td>0.781ms</td>
<td>0.783ms</td>
<td>0.804ms</td>
<td>0.601ms</td>
<td>136.42</td>
<td>2%</td>
<td>3%</td>
<td>93%</td>
<td>97%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-21"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_direction_hash" <span class="hljs-keyword">on</span> "movie_direction" <span class="hljs-keyword">using</span> hash ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_cast_hash" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> hash ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_hash" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> hash ("mov_title");
<span class="hljs-keyword">create</span> index "ix_director_hash" <span class="hljs-keyword">on</span> "director" <span class="hljs-keyword">using</span> hash ("dir_id");
</code></pre>
<p><img src="./images/query_11_improved_hash.svg" alt="Improved Query 11 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>8.405ms</td>
<td>8.499ms</td>
<td>8.313ms</td>
<td>8.406ms</td>
<td>0.516ms</td>
<td>2604.4</td>
<td>47%</td>
<td>33%</td>
<td>104%</td>
<td>97%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-21"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_direction_brin" <span class="hljs-keyword">on</span> "movie_direction" <span class="hljs-keyword">using</span> brin ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_cast_brin" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> brin ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_brin" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> brin ("mov_title");
<span class="hljs-keyword">create</span> index "ix_director_brin" <span class="hljs-keyword">on</span> "director" <span class="hljs-keyword">using</span> brin ("dir_id");
</code></pre>
<p><img src="./images/query_11_improved_brin.svg" alt="Improved Query 11 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>25.082ms</td>
<td>29.228ms</td>
<td>25.203ms</td>
<td>26.504ms</td>
<td>0.501ms</td>
<td>5488.57</td>
<td>100%</td>
<td>104%</td>
<td>102%</td>
<td>108%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-21"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_direction_btree" <span class="hljs-keyword">on</span> "movie_direction" <span class="hljs-keyword">using</span> btree ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_cast_btree" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> btree ("mov_id") include ("role") ;
<span class="hljs-keyword">create</span> index "ix_movie_cast_btree2" <span class="hljs-keyword">on</span> "movie_cast" <span class="hljs-keyword">using</span> btree ("role") include ("mov_id") ;
<span class="hljs-keyword">create</span> index "ix_movie_hash" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> hash ("mov_title");
<span class="hljs-keyword">create</span> index "ix_director_hash" <span class="hljs-keyword">on</span> "director" <span class="hljs-keyword">using</span> hash ("dir_id");
</code></pre>
<p><img src="./images/query_11_improved_mixed.svg" alt="Improved Query 11 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.81ms</td>
<td>0.774ms</td>
<td>0.745ms</td>
<td>0.776ms</td>
<td>0.65ms</td>
<td>111.45</td>
<td>2%</td>
<td>3%</td>
<td>93%</td>
<td>92%</td>
</tr>
</tbody></table>
<h3 id="query-12">Query 12</h3>
<p>Find the titles of all movies directed by the director whose first and last name are Woddy Allen.</p>
<pre><code class="hljs SQL"><span class="hljs-keyword">select</span> mov_title 
    <span class="hljs-keyword">from</span> movie 
    <span class="hljs-keyword">where</span> mov_id <span class="hljs-keyword">in</span> ( 
        <span class="hljs-keyword">select</span> mov_id 
            <span class="hljs-keyword">from</span> movie_direction 
            <span class="hljs-keyword">where</span> dir_id<span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> dir_id 
                    <span class="hljs-keyword">from</span> director 
                        <span class="hljs-keyword">where</span> dir_fname<span class="hljs-operator">=</span><span class="hljs-string">'Woddy'</span> <span class="hljs-keyword">and</span> dir_lname<span class="hljs-operator">=</span><span class="hljs-string">'Allen'</span>
                )
            )
        
</code></pre>
<h4 id="without-any-optimization-22"><strong>Without Any Optimization</strong></h4>
<p>Query returns 351 records</p>
<p><img src="./images/query_12_no_optimization.svg" alt="![Query 12 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
</tr>
</thead>
<tbody><tr>
<td>0.67ms</td>
<td>0.624ms</td>
<td>0.641ms</td>
<td>0.645ms</td>
<td>0.134ms</td>
<td>159.61</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-22"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_direction_btree" <span class="hljs-keyword">on</span> "movie_direction" <span class="hljs-keyword">using</span> btree ("dir_id");
<span class="hljs-keyword">create</span> index "ix_movie_btree" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> btree ("mov_id") include ("mov_title") ;
<span class="hljs-keyword">create</span> index "ix_director_btree" <span class="hljs-keyword">on</span> "director" <span class="hljs-keyword">using</span> btree ("dir_fname", "dir_lname") include ("dir_id") ;
</code></pre>
<p><img src="./images/query_12_btree.svg" alt="Query 12 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>0.341ms</td>
<td>0.328ms</td>
<td>0.33ms</td>
<td>0.333ms</td>
<td>0.163ms</td>
<td>13.04</td>
<td>8%</td>
<td>52%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-22"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_direction_hash" <span class="hljs-keyword">on</span> "movie_direction" <span class="hljs-keyword">using</span> hash ("dir_id");
<span class="hljs-keyword">create</span> index "ix_movie_hash" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> hash ("mov_id");
<span class="hljs-keyword">create</span> index "ix_director_hash" <span class="hljs-keyword">on</span> "director" <span class="hljs-keyword">using</span> hash ("dir_lname");
</code></pre>
<p><img src="./images/query_12_hash.svg" alt="Query 12 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>0.598ms</td>
<td>0.66ms</td>
<td>0.529ms</td>
<td>0.596ms</td>
<td>0.171ms</td>
<td>20.34</td>
<td>13%</td>
<td>92%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-22"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_direction_brin" <span class="hljs-keyword">on</span> "movie_direction" <span class="hljs-keyword">using</span> brin ("dir_id");
<span class="hljs-keyword">create</span> index "ix_movie_brin" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> brin ("mov_id");
<span class="hljs-keyword">create</span> index "ix_director_brin" <span class="hljs-keyword">on</span> "director" <span class="hljs-keyword">using</span> brin ("dir_lname");
</code></pre>
<p><img src="./images/query_12_brin.svg" alt="Query 12 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>0.641ms</td>
<td>0.629ms</td>
<td>0.628ms</td>
<td>0.633ms</td>
<td>0.133ms</td>
<td>159.61</td>
<td>100%</td>
<td>98%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-22"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_direction_btree" <span class="hljs-keyword">on</span> "movie_direction" <span class="hljs-keyword">using</span> btree ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_hash" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> hash ("mov_id");
<span class="hljs-keyword">create</span> index "ix_director_btree" <span class="hljs-keyword">on</span> "director" <span class="hljs-keyword">using</span> btree ("dir_fname", "dir_lname") include ("dir_id") ;
</code></pre>
<p><img src="./images/query_12_mixed.svg" alt="Query 12 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
</tr>
</thead>
<tbody><tr>
<td>0.638ms</td>
<td>0.579ms</td>
<td>0.293ms</td>
<td>0.503ms</td>
<td>0.144ms</td>
<td>16.62</td>
<td>10%</td>
<td>78%</td>
</tr>
</tbody></table>
<h4 id="improved-sql-11"><strong>Improved SQL</strong></h4>
<p>The improved query reduced the cost when using B-Tree indices. The execution time is about the same.
        The noticeable different is that in the original query, the engine's plan had one nested loop inner join with 3 tables, 
        while in the improved query case it had 2 nested loop inner joins with 2 tables each.</p>
<p><em><strong>We recommend creating B-Tree indices on <code>movie</code>, <code>movie_direction</code> and <code>director</code> tables as indicated in the create index statements below.</strong></em></p>
<pre><code class="hljs SQL"><span class="hljs-keyword">WITH</span> wa <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> dir_id <span class="hljs-keyword">from</span> director <span class="hljs-keyword">where</span> dir_fname<span class="hljs-operator">=</span><span class="hljs-string">'Woddy'</span> <span class="hljs-keyword">and</span> dir_lname<span class="hljs-operator">=</span><span class="hljs-string">'Allen'</span>),
wa_movies <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> mov_id <span class="hljs-keyword">from</span> movie_direction <span class="hljs-keyword">where</span> dir_id <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> dir_id <span class="hljs-keyword">from</span> wa))
<span class="hljs-keyword">select</span> mov_title 
<span class="hljs-keyword">from</span> movie m <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> wa_movies <span class="hljs-keyword">on</span> m.mov_id <span class="hljs-operator">=</span> wa_movies.mov_id
</code></pre>
<h4 id="without-any-optimization-23"><strong>Without Any Optimization</strong></h4>
<p>Query returns 351 records</p>
<p><img src="./images/query_12_improved_no_optimization.svg" alt="![Improved Query 12 Plan No Optmization]()"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.666ms</td>
<td>0.67ms</td>
<td>0.642ms</td>
<td>0.659ms</td>
<td>0.191ms</td>
<td>153.09</td>
<td>96%</td>
<td>102%</td>
</tr>
</tbody></table>
<h4 id="with-b-tree-indices-23"><strong>With B-TREE indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_direction_btree" <span class="hljs-keyword">on</span> "movie_direction" <span class="hljs-keyword">using</span> btree ("dir_id");
<span class="hljs-keyword">create</span> index "ix_movie_btree" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> btree ("mov_id") include ("mov_title") ;
<span class="hljs-keyword">create</span> index "ix_director_btree" <span class="hljs-keyword">on</span> "director" <span class="hljs-keyword">using</span> btree ("dir_fname", "dir_lname") include ("dir_id") ;
</code></pre>
<p><img src="./images/query_12_improved_btree.svg" alt="Improved Query 12 Plan B-TREE"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.329ms</td>
<td>0.331ms</td>
<td>0.328ms</td>
<td>0.329ms</td>
<td>0.237ms</td>
<td>9.67</td>
<td>6%</td>
<td>50%</td>
<td>74%</td>
<td>99%</td>
</tr>
</tbody></table>
<h4 id="with-hash-indices-23"><strong>With Hash indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_direction_hash" <span class="hljs-keyword">on</span> "movie_direction" <span class="hljs-keyword">using</span> hash ("dir_id");
<span class="hljs-keyword">create</span> index "ix_movie_hash" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> hash ("mov_id");
<span class="hljs-keyword">create</span> index "ix_director_hash" <span class="hljs-keyword">on</span> "director" <span class="hljs-keyword">using</span> hash ("dir_lname");
</code></pre>
<p><img src="./images/query_12_improved_hash.svg" alt="Improved Query 12 Plan Hash"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.567ms</td>
<td>0.61ms</td>
<td>0.413ms</td>
<td>0.53ms</td>
<td>0.249ms</td>
<td>13.97</td>
<td>9%</td>
<td>80%</td>
<td>69%</td>
<td>89%</td>
</tr>
</tbody></table>
<h4 id="with-brin-indices-23"><strong>With BRIN indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_direction_brin" <span class="hljs-keyword">on</span> "movie_direction" <span class="hljs-keyword">using</span> brin ("dir_id");
<span class="hljs-keyword">create</span> index "ix_movie_brin" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> brin ("mov_id");
<span class="hljs-keyword">create</span> index "ix_director_brin" <span class="hljs-keyword">on</span> "director" <span class="hljs-keyword">using</span> brin ("dir_lname");
</code></pre>
<p><img src="./images/query_12_improved_brin.svg" alt="Improved Query 12 Plan BRIN"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.723ms</td>
<td>0.645ms</td>
<td>1.087ms</td>
<td>0.818ms</td>
<td>0.257ms</td>
<td>153.09</td>
<td>100%</td>
<td>124%</td>
<td>96%</td>
<td>129%</td>
</tr>
</tbody></table>
<h4 id="with-mixed-indices-23"><strong>With Mixed indices</strong></h4>
<pre><code class="hljs SQL"><span class="hljs-keyword">create</span> index "ix_movie_direction_btree" <span class="hljs-keyword">on</span> "movie_direction" <span class="hljs-keyword">using</span> btree ("mov_id");
<span class="hljs-keyword">create</span> index "ix_movie_hash" <span class="hljs-keyword">on</span> "movie" <span class="hljs-keyword">using</span> hash ("mov_id");
<span class="hljs-keyword">create</span> index "ix_director_btree" <span class="hljs-keyword">on</span> "director" <span class="hljs-keyword">using</span> btree ("dir_fname", "dir_lname") include ("dir_id") ;
</code></pre>
<p><img src="./images/query_12_improved_mixed.svg" alt="Improved Query 12 Plan Mixed"></p>
<table>
<thead>
<tr>
<th>Run 1</th>
<th>Run 2</th>
<th>Run 3</th>
<th>Average</th>
<th>Planning</th>
<th>Cost</th>
<th>Cost vs w/o Indexes</th>
<th>Time vs w/o Indexes</th>
<th>Cost vs Unoptimized</th>
<th>Time vs Unoptimized</th>
</tr>
</thead>
<tbody><tr>
<td>0.624ms</td>
<td>0.656ms</td>
<td>0.583ms</td>
<td>0.621ms</td>
<td>0.235ms</td>
<td>10.25</td>
<td>7%</td>
<td>94%</td>
<td>62%</td>
<td>123%</td>
</tr>
</tbody></table>
<h2 id="conclusion">Conclusion</h2>
<p>In all queries the B-Tree index performed better than Hash and BRIN indices. 
B-Tree also had the advantage of supporting an index on multiple columns which is not supported in either Hash or BRIN.
Also B-Tree support <code>include</code> clause,  which can improve the performance by including a column with the index, and therefore making the engine skip the step where it has to lookup the value after using the index.</p>
<p>The Hash index did improve the performance of many queries, however the B-Tree index always performed better.</p>
<p>As for the BRIN index, it had no effect whatsoever on most queries.</p>

	

</body></html>